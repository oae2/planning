<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8">
  <title>Advanced PDF Tool</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/qr-code-styling@1.5.0/lib/qr-code-styling.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf-lib/1.17.1/pdf-lib.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/fabric.js/5.3.0/fabric.min.js"></script>
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Sarabun:400,700|Prompt:400,700|Kanit:400,700|Mitr:400,700|Maitree:400,700|Pridi:400,700|Sriracha|Srisakdi:400,700|Taviraj:400,700|Niramit:400,700|Chonburi|Charmonman:400,700|Charm|Pattaya|Bai+Jamjuree:400,700|Mali:400,700|Sura:400,700|Noto+Sans+Thai:400,700|Noto+Serif+Thai:400,700|Arial:400,700|Times+New+Roman:400,700|Helvetica:400,700|Courier+New:400,700|Georgia:400,700|Verdana:400,700|Trebuchet+MS:400,700|Comic+Sans+MS:400,700|Impact:400,700|Lucida+Console:400,700&display=swap">
  <style>
    .tool-card {
      transition: all 0.3s ease;
      cursor: pointer;
    }
    .tool-card:hover {
      transform: translateY(-5px);
      box-shadow: 0 10px 25px rgba(0,0,0,0.1);
    }
    .tool-icon {
      font-size: 3rem;
      margin-bottom: 1rem;
    }
    .progress-bar {
      transition: width 0.3s ease;
    }
    .file-drop-zone {
      border: 2px dashed #e5e7eb;
      transition: all 0.3s ease;
    }
    .file-drop-zone.dragover {
      border-color: #3b82f6;
      background-color: #eff6ff;
    }
    .animate-bounce-gentle {
      animation: bounce-gentle 2s infinite;
    }
    @keyframes bounce-gentle {
      0%, 20%, 53%, 80%, 100% { transform: translateY(0); }
      40%, 43% { transform: translateY(-10px); }
      70% { transform: translateY(-5px); }
    }
    .gradient-bg {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    }
    .text-shadow {
      text-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }
    
    /* PDF Card Styles */
    .pdf-card {
      border: 2px solid #e5e7eb;
      border-radius: 12px;
      transition: all 0.3s ease;
      cursor: move;
      position: relative;
      background: white;
    }
    .pdf-card:hover {
      border-color: #ef4444;
      box-shadow: 0 8px 25px rgba(239, 68, 68, 0.15);
      transform: translateY(-2px);
    }
    .pdf-card.dragging {
      opacity: 0.5;
      transform: rotate(5deg) scale(0.95);
      z-index: 1000;
    }
    .pdf-card.drag-over {
      border-color: #ef4444;
      background-color: #fef2f2;
      border-style: dashed;
    }
    
    .pdf-thumbnail {
      width: 100%;
      height: 200px;
      object-fit: cover;
      border-radius: 8px 8px 0 0;
      background: #f8fafc;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    
    .pdf-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
      gap: 20px;
      margin: 20px 0;
    }
    
    .page-number {
      position: absolute;
      top: 8px;
      left: 8px;
      background: rgba(239, 68, 68, 0.9);
      color: white;
      border-radius: 20px;
      width: 32px;
      height: 32px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: bold;
      font-size: 14px;
    }
    
    .remove-btn {
      position: absolute;
      top: 8px;
      right: 8px;
      background: rgba(0, 0, 0, 0.7);
      color: white;
      border-radius: 50%;
      width: 32px;
      height: 32px;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      opacity: 0;
      transition: opacity 0.3s ease;
    }
    .pdf-card:hover .remove-btn {
      opacity: 1;
    }
    
    .drag-placeholder {
      border: 2px dashed #ef4444;
      background: rgba(239, 68, 68, 0.1);
      border-radius: 12px;
      display: flex;
      align-items: center;
      justify-content: center;
      color: #ef4444;
      font-weight: 500;
      min-height: 280px;
    }
    
    .merge-area {
      min-height: 400px;
      padding: 20px;
      border-radius: 12px;
      background: #f8fafc;
      border: 2px dashed #d1d5db;
      transition: all 0.3s ease;
    }
    
    .merge-area.has-files {
      background: white;
      border: 1px solid #e5e7eb;
    }
    
    .control-panel {
      background: white;
      border-radius: 12px;
      padding: 24px;
      box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
      position: sticky;
      top: 20px;
    }
    
    /* Split Tool Specific Styles */
    .split-tab-active {
      background: white !important;
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1) !important;
      color: #dc2626 !important;
    }
    
    .split-tab-inactive {
      color: #6b7280;
      background: transparent;
    }
    
    .split-tab-inactive:hover {
      background: #f9fafb;
    }
    
    .range-mode-active {
      border-color: #dc2626 !important;
      background-color: #fef2f2 !important;
      color: #dc2626 !important;
    }
    
    .range-mode-inactive {
      border-color: #e5e7eb;
      color: #6b7280;
    }
    
    .range-mode-inactive:hover {
      border-color: #fecaca;
    }
    
    /* PDF Page Thumbnail Styles */
    .pdf-page-item {
      position: relative;
      background: white;
      border: 2px solid #e5e7eb;
      border-radius: 8px;
      overflow: hidden;
      transition: all 0.3s ease;
      cursor: pointer;
      aspect-ratio: 3/4;
    }
    
    .pdf-page-item:hover {
      border-color: #ef4444;
      box-shadow: 0 4px 12px rgba(239, 68, 68, 0.15);
      transform: translateY(-2px);
    }
    
    .pdf-page-item.selected {
      border-color: #10b981;
      box-shadow: 0 4px 12px rgba(16, 185, 129, 0.25);
      transform: translateY(-2px);
    }
    
    .pdf-page-canvas {
      width: 100%;
      height: 100%;
      object-fit: contain;
    }
    
    .page-number-badge {
      position: absolute;
      bottom: 4px;
      left: 4px;
      background: rgba(0, 0, 0, 0.7);
      color: white;
      border-radius: 4px;
      padding: 2px 6px;
      font-size: 11px;
      font-weight: bold;
    }
    
    .selection-indicator {
      position: absolute;
      top: 4px;
      right: 4px;
      width: 24px;
      height: 24px;
      border-radius: 50%;
      background: rgba(255, 255, 255, 0.9);
      border: 2px solid #d1d5db;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: all 0.3s ease;
    }
    
    .pdf-page-item.selected .selection-indicator {
      background: #10b981;
      border-color: #10b981;
      color: white;
    }
    
    .pdf-page-item.selected .selection-indicator::after {
      content: '‚úì';
      font-size: 12px;
      font-weight: bold;
    }

    /* Edit PDF Styles */
    body { 
      font-family: 'Sarabun', 'Prompt', 'Kanit', Arial, sans-serif; 
    }
    .toolbar-btn { 
      width: 48px; 
      height: 48px; 
      border-radius: 0.5rem; 
      display: flex; 
      align-items: center; 
      justify-content: center; 
      margin-bottom: 0.5rem; 
      font-size: 1.5rem; 
      background: none; 
      border: 1px solid #e5e7eb;
      transition: all 0.3s ease;
    }
    .toolbar-btn:hover {
      background: #f3f4f6;
    }
    .toolbar-btn.active { 
      background: #3b82f6; 
      color: white; 
      border-color: #3b82f6;
    }
    #edit-prop-panel label { 
      font-weight: 500; 
      margin-top: 0.5rem; 
    }
    #edit-prop-panel input, #edit-prop-panel select { 
      width: 100%; 
      margin-bottom: 0.5rem; 
      border: 1px solid #ddd; 
      border-radius: 6px; 
      padding: 2px 6px; 
    }
  </style>
</head>
<body class="bg-gray-50 min-h-screen">
  <!-- Header -->
  <header class="gradient-bg text-white py-6 shadow-lg">
    <div class="container mx-auto px-4">
      <div class="flex items-center justify-between">
        <div>
          <h1 class="text-3xl font-bold text-shadow">üîß Advanced PDF Tools</h1>
          <p class="text-blue-100 mt-1">‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏°‡∏∑‡∏≠ PDF</p>
        </div>
        <button onclick="goBack()" class="bg-white bg-opacity-20 hover:bg-opacity-30 px-4 py-2 rounded-lg transition-all">
          ‚Üê ‡∏Å‡∏•‡∏±‡∏ö‡∏´‡∏ô‡πâ‡∏≤‡∏´‡∏•‡∏±‡∏Å
        </button>
      </div>
    </div>
  </header>

  <!-- Main Content -->
  <main class="container mx-auto px-4 py-8">
    
    <!-- PDF Tools Grid -->
    <section id="pdf-tools-grid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6">
      
      <!-- Merge PDF -->
      <div class="tool-card bg-white rounded-xl p-6 shadow-md hover:shadow-xl" onclick="openTool('merge')">
        <div class="text-center">
          <div class="tool-icon text-red-500">üìÑüìÑ</div>
          <h3 class="text-xl font-semibold text-gray-800 mb-2">Merge PDF</h3>
          <p class="text-gray-600 text-sm">‡∏£‡∏ß‡∏°‡∏´‡∏•‡∏≤‡∏¢‡πÑ‡∏ü‡∏•‡πå PDF ‡πÄ‡∏õ‡πá‡∏ô‡πÑ‡∏ü‡∏•‡πå‡πÄ‡∏î‡∏µ‡∏¢‡∏ß</p>
        </div>
      </div>

      <!-- Split PDF -->
      <div class="tool-card bg-white rounded-xl p-6 shadow-md hover:shadow-xl" onclick="openTool('split')">
        <div class="text-center">
          <div class="tool-icon text-orange-500">‚úÇÔ∏èüìÑ</div>
          <h3 class="text-xl font-semibold text-gray-800 mb-2">Split PDF</h3>
          <p class="text-gray-600 text-sm">‡πÅ‡∏¢‡∏Å‡∏´‡∏ô‡πâ‡∏≤ PDF ‡πÄ‡∏õ‡πá‡∏ô‡πÑ‡∏ü‡∏•‡πå‡πÅ‡∏¢‡∏Å‡∏ï‡πà‡∏≤‡∏á‡∏´‡∏≤‡∏Å</p>
        </div>
      </div>

      <!-- Compress PDF -->
      <div class="tool-card bg-white rounded-xl p-6 shadow-md hover:shadow-xl" onclick="openTool('compress')">
        <div class="text-center">
          <div class="tool-icon text-green-500">üóúÔ∏è</div>
          <h3 class="text-xl font-semibold text-gray-800 mb-2">Compress PDF</h3>
          <p class="text-gray-600 text-sm">‡∏•‡∏î‡∏Ç‡∏ô‡∏≤‡∏î‡πÑ‡∏ü‡∏•‡πå PDF ‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏°‡∏µ‡∏õ‡∏£‡∏∞‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡∏†‡∏≤‡∏û</p>
        </div>
      </div>

      <!-- Edit PDF -->
      <div class="tool-card bg-white rounded-xl p-6 shadow-md hover:shadow-xl" onclick="openTool('edit')">
        <div class="text-center">
          <div class="tool-icon text-purple-500">‚úèÔ∏è</div>
          <h3 class="text-xl font-semibold text-gray-800 mb-2">Edit PDF</h3>
          <p class="text-gray-600 text-sm">‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÅ‡∏•‡∏∞‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û‡πÉ‡∏ô PDF</p>
        </div>
      </div>

      <!-- PDF to Word -->
      <div class="tool-card bg-white rounded-xl p-6 shadow-md hover:shadow-xl" onclick="openTool('pdf-to-word')">
        <div class="text-center">
          <div class="tool-icon text-blue-500">üìÑ‚Üíüìù</div>
          <h3 class="text-xl font-semibold text-gray-800 mb-2">PDF to Word</h3>
          <p class="text-gray-600 text-sm">‡πÅ‡∏õ‡∏•‡∏á PDF ‡πÄ‡∏õ‡πá‡∏ô Word (.docx)</p>
        </div>
      </div>

      <!-- Word to PDF -->
      <div class="tool-card bg-white rounded-xl p-6 shadow-md hover:shadow-xl" onclick="openTool('word-to-pdf')">
        <div class="text-center">
          <div class="tool-icon text-blue-600">üìù‚ÜíüìÑ</div>
          <h3 class="text-xl font-semibold text-gray-800 mb-2">Word to PDF</h3>
          <p class="text-gray-600 text-sm">‡πÅ‡∏õ‡∏•‡∏á Word ‡πÄ‡∏õ‡πá‡∏ô PDF</p>
        </div>
      </div>

      <!-- PDF to PowerPoint -->
      <div class="tool-card bg-white rounded-xl p-6 shadow-md hover:shadow-xl" onclick="openTool('pdf-to-ppt')">
        <div class="text-center">
          <div class="tool-icon text-orange-600">üìÑ‚Üíüìä</div>
          <h3 class="text-xl font-semibold text-gray-800 mb-2">PDF to PowerPoint</h3>
          <p class="text-gray-600 text-sm">‡πÅ‡∏õ‡∏•‡∏á PDF ‡πÄ‡∏õ‡πá‡∏ô PowerPoint</p>
        </div>
      </div>

      <!-- PowerPoint to PDF -->
      <div class="tool-card bg-white rounded-xl p-6 shadow-md hover:shadow-xl" onclick="openTool('ppt-to-pdf')">
        <div class="text-center">
          <div class="tool-icon text-red-600">üìä‚ÜíüìÑ</div>
          <h3 class="text-xl font-semibold text-gray-800 mb-2">PowerPoint to PDF</h3>
          <p class="text-gray-600 text-sm">‡πÅ‡∏õ‡∏•‡∏á PowerPoint ‡πÄ‡∏õ‡πá‡∏ô PDF</p>
        </div>
      </div>

      <!-- PDF to Excel -->
      <div class="tool-card bg-white rounded-xl p-6 shadow-md hover:shadow-xl" onclick="openTool('pdf-to-excel')">
        <div class="text-center">
          <div class="tool-icon text-green-600">üìÑ‚Üíüìà</div>
          <h3 class="text-xl font-semibold text-gray-800 mb-2">PDF to Excel</h3>
          <p class="text-gray-600 text-sm">‡πÅ‡∏õ‡∏•‡∏á PDF ‡πÄ‡∏õ‡πá‡∏ô Excel</p>
        </div>
      </div>

      <!-- Excel to PDF -->
      <div class="tool-card bg-white rounded-xl p-6 shadow-md hover:shadow-xl" onclick="openTool('excel-to-pdf')">
        <div class="text-center">
          <div class="tool-icon text-green-700">üìà‚ÜíüìÑ</div>
          <h3 class="text-xl font-semibold text-gray-800 mb-2">Excel to PDF</h3>
          <p class="text-gray-600 text-sm">‡πÅ‡∏õ‡∏•‡∏á Excel ‡πÄ‡∏õ‡πá‡∏ô PDF</p>
        </div>
      </div>

      <!-- PDF to JPG -->
      <div class="tool-card bg-white rounded-xl p-6 shadow-md hover:shadow-xl" onclick="openTool('pdf-to-jpg')">
        <div class="text-center">
          <div class="tool-icon text-yellow-500">üìÑ‚ÜíüñºÔ∏è</div>
          <h3 class="text-xl font-semibold text-gray-800 mb-2">PDF to JPG</h3>
          <p class="text-gray-600 text-sm">‡πÅ‡∏õ‡∏•‡∏á PDF ‡πÄ‡∏õ‡πá‡∏ô‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û JPG</p>
        </div>
      </div>

      <!-- JPG to PDF -->
      <div class="tool-card bg-white rounded-xl p-6 shadow-md hover:shadow-xl" onclick="openTool('jpg-to-pdf')">
        <div class="text-center">
          <div class="tool-icon text-yellow-600">üñºÔ∏è‚ÜíüìÑ</div>
          <h3 class="text-xl font-semibold text-gray-800 mb-2">JPG to PDF</h3>
          <p class="text-gray-600 text-sm">‡πÅ‡∏õ‡∏•‡∏á‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û JPG ‡πÄ‡∏õ‡πá‡∏ô PDF</p>
        </div>
      </div>

      <!-- Sign PDF -->
      <div class="tool-card bg-white rounded-xl p-6 shadow-md hover:shadow-xl" onclick="openTool('sign')">
        <div class="text-center">
          <div class="tool-icon text-indigo-500">‚úçÔ∏è</div>
          <h3 class="text-xl font-semibold text-gray-800 mb-2">Sign PDF</h3>
          <p class="text-gray-600 text-sm">‡πÄ‡∏ã‡πá‡∏ô‡∏•‡∏≤‡∏¢‡πÄ‡∏ã‡πá‡∏ô‡πÉ‡∏ô‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£ PDF</p>
        </div>
      </div>

      <!-- Watermark PDF -->
      <div class="tool-card bg-white rounded-xl p-6 shadow-md hover:shadow-xl" onclick="openTool('watermark')">
        <div class="text-center">
          <div class="tool-icon text-cyan-500">üíß</div>
          <h3 class="text-xl font-semibold text-gray-800 mb-2">Watermark</h3>
          <p class="text-gray-600 text-sm">‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏•‡∏≤‡∏¢‡∏ô‡πâ‡∏≥‡πÉ‡∏ô PDF</p>
        </div>
      </div>

      <!-- Rotate PDF -->
      <div class="tool-card bg-white rounded-xl p-6 shadow-md hover:shadow-xl" onclick="openTool('rotate')">
        <div class="text-center">
          <div class="tool-icon text-pink-500">üîÑ</div>
          <h3 class="text-xl font-semibold text-gray-800 mb-2">Rotate PDF</h3>
          <p class="text-gray-600 text-sm">‡∏´‡∏°‡∏∏‡∏ô‡∏´‡∏ô‡πâ‡∏≤ PDF</p>
        </div>
      </div>

      <!-- Unlock PDF -->
      <div class="tool-card bg-white rounded-xl p-6 shadow-md hover:shadow-xl" onclick="openTool('unlock')">
        <div class="text-center">
          <div class="tool-icon text-emerald-500">üîì</div>
          <h3 class="text-xl font-semibold text-gray-800 mb-2">Unlock PDF</h3>
          <p class="text-gray-600 text-sm">‡∏õ‡∏•‡∏î‡∏•‡πá‡∏≠‡∏Ñ‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô PDF</p>
        </div>
      </div>

      <!-- Protect PDF -->
      <div class="tool-card bg-white rounded-xl p-6 shadow-md hover:shadow-xl" onclick="openTool('protect')">
        <div class="text-center">
          <div class="tool-icon text-slate-500">üîí</div>
          <h3 class="text-xl font-semibold text-gray-800 mb-2">Protect PDF</h3>
          <p class="text-gray-600 text-sm">‡πÉ‡∏™‡πà‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô PDF</p>
        </div>
      </div>

      <!-- HTML to PDF -->
      <div class="tool-card bg-white rounded-xl p-6 shadow-md hover:shadow-xl" onclick="openTool('html-to-pdf')">
        <div class="text-center">
          <div class="tool-icon text-amber-500">üåê‚ÜíüìÑ</div>
          <h3 class="text-xl font-semibold text-gray-800 mb-2">HTML to PDF</h3>
          <p class="text-gray-600 text-sm">‡πÅ‡∏õ‡∏•‡∏á‡πÄ‡∏ß‡πá‡∏ö‡πÄ‡∏û‡∏à HTML ‡πÄ‡∏õ‡πá‡∏ô PDF</p>
        </div>
      </div>

    </section>

    <!-- Edit PDF Tool -->
    <section id="edit-tool" class="hidden">
      <div class="max-w-7xl mx-auto">
        <div class="text-center mb-8">
          <h2 class="text-3xl font-bold text-gray-800 mb-2">‚úèÔ∏è Edit PDF File</h2>
          <p class="text-gray-600">‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏° ‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û ‡πÅ‡∏•‡∏∞‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏≠‡∏á‡∏Ñ‡πå‡∏õ‡∏£‡∏∞‡∏Å‡∏≠‡∏ö‡∏ï‡πà‡∏≤‡∏á‡πÜ ‡πÉ‡∏ô PDF</p>
        </div>

        <div class="flex flex-col md:flex-row gap-4">
          <!-- Left Toolbar -->
          <aside class="bg-white rounded-xl shadow flex flex-col items-center py-3 gap-1 md:w-20 w-full">
            <button class="toolbar-btn" id="edit_tool_select" title="Select" onclick="setEditTool('select')">üñ±Ô∏è</button>
            <button class="toolbar-btn" id="edit_tool_text" title="Text" onclick="setEditTool('text')">üìù</button>
            <button class="toolbar-btn" id="edit_tool_rect" title="Rectangle" onclick="setEditTool('rect')">‚ñ≠</button>
            <button class="toolbar-btn" id="edit_tool_circle" title="Circle" onclick="setEditTool('circle')">‚óØ</button>
            <button class="toolbar-btn" id="edit_tool_line" title="Line" onclick="setEditTool('line')">Ôºè</button>
            <button class="toolbar-btn" id="edit_tool_image" title="Image" onclick="setEditTool('image')">üñºÔ∏è</button>
            <button class="toolbar-btn" id="edit_tool_highlight" title="Highlight" onclick="setEditTool('highlight')">üñçÔ∏è</button>
            <button class="toolbar-btn" id="edit_tool_signature" title="Sign" onclick="setEditTool('signature')">‚úçÔ∏è</button>
            <button class="toolbar-btn" id="edit_tool_undo" title="Undo" onclick="editUndo()">‚Ü©Ô∏è</button>
            <button class="toolbar-btn" id="edit_tool_redo" title="Redo" onclick="editRedo()">‚Ü™Ô∏è</button>
          </aside>

          <!-- Main Editor Area -->
          <div class="flex-1 flex flex-col items-center gap-3">
            <!-- Top Controls -->
            <div class="flex flex-wrap gap-2 justify-between w-full bg-white rounded-lg p-4 shadow">
              <input type="file" id="edit-file-input" accept="application/pdf" class="hidden" onchange="openEditPdf(this)">
              <button onclick="document.getElementById('edit-file-input').click()" class="bg-blue-600 text-white px-4 py-2 rounded shadow">
                üìÇ ‡πÄ‡∏õ‡∏¥‡∏î‡πÑ‡∏ü‡∏•‡πå PDF
              </button>
              <button onclick="saveEditedPdf()" class="bg-green-600 text-white px-4 py-2 rounded shadow">
                üíæ Save PDF
              </button>
              <div class="flex items-center gap-2">
                <button onclick="editZoom(-1)" class="bg-gray-200 hover:bg-gray-300 px-3 py-1 rounded">-</button>
                <span id="edit-zoom-view" class="px-2">100%</span>
                <button onclick="editZoom(1)" class="bg-gray-200 hover:bg-gray-300 px-3 py-1 rounded">+</button>
              </div>
              <div class="flex items-center gap-2">
                <button onclick="prevEditPage()" class="bg-gray-200 hover:bg-gray-300 px-3 py-1 rounded">‚¨ÖÔ∏è</button>
                <span id="edit-page-view" class="px-2">1/1</span>
                <button onclick="nextEditPage()" class="bg-gray-200 hover:bg-gray-300 px-3 py-1 rounded">‚û°Ô∏è</button>
              </div>
            </div>

            <!-- Canvas Area -->
            <div class="border rounded-xl bg-white shadow mx-auto" style="overflow:auto;">
              <canvas id="edit-fabric-canvas" width="800" height="1132"></canvas>
            </div>

            <!-- File Upload Area (when no PDF loaded) -->
            <div id="edit-drop-zone" class="file-drop-zone border-2 border-dashed border-gray-300 rounded-lg p-12 text-center cursor-pointer">
              <div class="animate-bounce-gentle mb-4">
                <div class="text-6xl text-gray-400">üìÑ</div>
              </div>
              <h3 class="text-xl font-semibold text-gray-700 mb-2">‡∏•‡∏≤‡∏Å‡πÑ‡∏ü‡∏•‡πå PDF ‡∏´‡∏£‡∏∑‡∏≠‡∏Ñ‡∏•‡∏¥‡∏Å‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏•‡∏∑‡∏≠‡∏Å</h3>
              <p class="text-gray-500 mb-4">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÑ‡∏ü‡∏•‡πå PDF ‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç</p>
              <button onclick="document.getElementById('edit-file-input').click()" class="bg-purple-600 text-white px-6 py-3 rounded-lg hover:bg-purple-700 transition-all">
                ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÑ‡∏ü‡∏•‡πå PDF
              </button>
            </div>
          </div>

          <!-- Right Properties Panel -->
          <aside class="w-72 bg-white rounded-xl shadow p-4" id="edit-prop-panel">
            <span class="text-gray-400">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏î‡∏π‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î</span>
          </aside>
        </div>
      </div>
    </section>

    <!-- Split PDF Tool -->
    <section id="split-tool" class="hidden">
      <div class="max-w-7xl mx-auto">
        <div class="text-center mb-8">
          <h2 class="text-3xl font-bold text-gray-800 mb-2">‚úÇÔ∏è Split PDF File</h2>
          <p class="text-gray-600">‡πÅ‡∏¢‡∏Å‡πÑ‡∏ü‡∏•‡πå PDF ‡πÄ‡∏õ‡πá‡∏ô‡∏´‡∏ô‡πâ‡∏≤‡πÅ‡∏¢‡∏Å‡∏´‡∏£‡∏∑‡∏≠‡∏ä‡πà‡∏ß‡∏á‡∏´‡∏ô‡πâ‡∏≤‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£</p>
        </div>

        <div class="grid grid-cols-1 lg:grid-cols-4 gap-6">
          <!-- Main Content Area -->
          <div class="lg:col-span-3">
            <!-- File Upload -->
            <div id="split-drop-zone" class="file-drop-zone border-2 border-dashed border-gray-300 rounded-lg p-12 text-center mb-6 cursor-pointer">
              <div class="animate-bounce-gentle mb-4">
                <div class="text-6xl text-gray-400">üìÑ</div>
              </div>
              <h3 class="text-xl font-semibold text-gray-700 mb-2">‡∏•‡∏≤‡∏Å‡πÑ‡∏ü‡∏•‡πå PDF ‡∏´‡∏£‡∏∑‡∏≠‡∏Ñ‡∏•‡∏¥‡∏Å‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏•‡∏∑‡∏≠‡∏Å</h3>
              <p class="text-gray-500 mb-4">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÑ‡∏ü‡∏•‡πå PDF ‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡πÅ‡∏¢‡∏Å</p>
              <input type="file" id="split-file" accept=".pdf" class="hidden">
              <button onclick="document.getElementById('split-file').click()" class="bg-red-600 text-white px-6 py-3 rounded-lg hover:bg-red-700 transition-all">
                ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÑ‡∏ü‡∏•‡πå PDF
              </button>
            </div>

            <!-- PDF Pages Grid -->
            <div id="pdf-pages-container" class="hidden">
              <div class="mb-4 p-4 bg-blue-50 border border-blue-200 rounded-lg">
                <div id="split-file-details" class="text-blue-700 text-sm"></div>
              </div>
              
              <!-- Pages Grid -->
              <div id="pdf-pages-grid" class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 xl:grid-cols-6 gap-4 mb-6">
                <!-- PDF page thumbnails will be inserted here -->
              </div>
            </div>

            <!-- Progress -->
            <div id="split-progress" class="hidden mt-6">
              <div class="bg-white rounded-lg shadow-lg p-6">
                <div class="bg-gray-200 rounded-full h-4 overflow-hidden mb-2">
                  <div id="split-progress-bar" class="progress-bar bg-red-600 h-full transition-all duration-300" style="width: 0%"></div>
                </div>
                <p class="text-center text-sm text-gray-600">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÅ‡∏¢‡∏Å‡πÑ‡∏ü‡∏•‡πå... <span id="split-progress-text">0%</span></p>
              </div>
            </div>

            <!-- Result -->
            <div id="split-result" class="hidden mt-6">
              <div class="bg-white rounded-lg shadow-lg p-6">
                <h3 class="text-lg font-semibold text-green-800 mb-2">‚úÖ ‡πÅ‡∏¢‡∏Å‡πÑ‡∏ü‡∏•‡πå‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!</h3>
                <p class="text-green-700 mb-4" id="split-result-text"></p>
                <div id="split-download-links" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-3"></div>
              </div>
            </div>
          </div>

          <!-- Right Sidebar: Split Options -->
          <div class="lg:col-span-1">
            <div class="bg-white rounded-lg shadow-lg p-6 sticky top-6">
              <h3 class="text-lg font-bold text-gray-800 mb-6 text-center">Split</h3>

              <!-- Split Mode Tabs -->
              <div id="split-mode-tabs" class="flex mb-6 bg-gray-100 rounded-lg p-1">
                <button id="tab-range" onclick="switchSplitTab('range')" class="flex-1 py-2 px-3 rounded-md text-gray-600 font-medium text-sm transition-all hover:bg-gray-50">
                  <div class="text-center">
                    <div class="text-lg mb-1">üìä</div>
                    <div>Range</div>
                  </div>
                </button>
                <button id="tab-pages" onclick="switchSplitTab('pages')" class="flex-1 py-2 px-3 rounded-md bg-white shadow text-red-600 font-medium text-sm transition-all">
                  <div class="text-center">
                    <div class="text-lg mb-1">üìÑ</div>
                    <div>Pages</div>
                  </div>
                </button>
                <button id="tab-size" onclick="switchSplitTab('size')" class="flex-1 py-2 px-3 rounded-md text-gray-600 font-medium text-sm transition-all hover:bg-gray-50">
                  <div class="text-center">
                    <div class="text-lg mb-1">üìê</div>
                    <div>Size</div>
                  </div>
                </button>
              </div>

              <!-- Pages Tab Content (Default Active) -->
              <div id="pages-tab-content" class="space-y-4">
                <div class="mb-4">
                  <div class="text-sm font-medium text-gray-700 mb-3">Extract mode:</div>
                  <div class="space-y-2">
                    <label class="flex items-center p-3 border border-red-500 bg-red-50 rounded-lg cursor-pointer">
                      <input type="radio" name="extract-mode" value="all" class="mr-3 text-red-600" checked>
                      <div>
                        <div class="font-medium text-red-600">Extract all pages</div>
                        <div class="text-xs text-gray-500">Create separate PDF for each page</div>
                      </div>
                    </label>
                    <label class="flex items-center p-3 border border-gray-200 rounded-lg cursor-pointer hover:border-red-200">
                      <input type="radio" name="extract-mode" value="selected" class="mr-3 text-red-600">
                      <div>
                        <div class="font-medium text-gray-700">Select pages</div>
                        <div class="text-xs text-gray-500">Choose specific pages to extract</div>
                      </div>
                    </label>
                  </div>
                </div>

                <!-- Selected Pages Info -->
                <div id="selected-info" class="p-3 bg-blue-50 rounded-lg text-sm text-blue-700">
                  <div id="selected-count">Selected pages will be converted into separate PDF files.</div>
                  <div id="files-count" class="font-semibold mt-1">0 PDF will be created.</div>
                </div>

                <!-- Control Buttons -->
                <div class="space-y-2">
                  <button onclick="selectAllPages()" class="w-full py-2 px-4 bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200 transition-all text-sm">
                    Select All Pages
                  </button>
                  <button onclick="deselectAllPages()" class="w-full py-2 px-4 bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200 transition-all text-sm">
                    Deselect All Pages
                  </button>
                </div>
              </div>

              <!-- Range Tab Content -->
              <div id="range-tab-content" class="hidden space-y-4">
                <div class="mb-4">
                  <div class="text-sm font-medium text-gray-700 mb-3">Range mode:</div>
                  <div class="flex gap-2">
                    <button id="custom-ranges-btn" onclick="selectRangeMode('custom')" class="flex-1 py-2 px-3 text-sm border-2 border-red-500 bg-red-50 text-red-600 rounded-lg font-medium">
                      Custom ranges
                    </button>
                    <button id="fixed-ranges-btn" onclick="selectRangeMode('fixed')" class="flex-1 py-2 px-3 text-sm border-2 border-gray-200 text-gray-600 rounded-lg hover:border-red-200">
                      Fixed ranges
                    </button>
                  </div>
                </div>

                <div id="custom-ranges-content">
                  <div class="mb-4">
                    <div class="flex items-center justify-between mb-2">
                      <span class="text-sm font-medium text-gray-700">üìä Range 1</span>
                    </div>
                    <div class="grid grid-cols-2 gap-2 mb-2">
                      <div>
                        <label class="block text-xs text-gray-500 mb-1">from page</label>
                        <input type="number" id="range1-from" class="w-full p-2 border border-gray-300 rounded text-center" min="1" value="1">
                      </div>
                      <div>
                        <label class="block text-xs text-gray-500 mb-1">to</label>
                        <input type="number" id="range1-to" class="w-full p-2 border border-gray-300 rounded text-center" min="1" value="2">
                      </div>
                    </div>
                  </div>

                  <button onclick="addRange()" class="w-full py-2 px-4 border-2 border-red-500 text-red-600 rounded-lg hover:bg-red-50 transition-all mb-4">
                    <span class="text-lg mr-1">+</span> Add Range
                  </button>

                  <div id="additional-ranges"></div>

                  <div class="mb-4">
                    <label class="flex items-center text-sm">
                      <input type="checkbox" id="merge-ranges" class="mr-2 rounded">
                      <span class="text-gray-700">Merge all ranges in one PDF file.</span>
                    </label>
                  </div>
                </div>

                <div id="fixed-ranges-content" class="hidden">
                  <div class="mb-4">
                    <label class="block text-sm font-medium text-gray-700 mb-2">Pages per file:</label>
                    <input type="number" id="pages-per-file" class="w-full p-3 border border-gray-300 rounded-lg text-center" min="1" value="1">
                  </div>
                </div>
              </div>

              <!-- Size Tab Content -->
              <div id="size-tab-content" class="hidden space-y-4">
                <div class="mb-4">
                  <label class="block text-sm font-medium text-gray-700 mb-2">Maximum file size (MB):</label>
                  <input type="number" id="max-file-size" class="w-full p-3 border border-gray-300 rounded-lg text-center" min="1" value="10">
                </div>
                <div class="text-xs text-gray-500">
                  <p>Files will be split to keep each part under this size limit.</p>
                </div>
              </div>

              <!-- Split Button -->
              <div class="mt-6">
                <button id="split-btn" onclick="executeSplit()" class="w-full bg-red-600 text-white py-4 rounded-lg text-lg font-semibold hover:bg-red-700 transition-all disabled:opacity-50 disabled:cursor-not-allowed shadow-lg" disabled>
                  <span class="mr-2">‚ÜóÔ∏è</span>Split PDF
                </button>
              </div>
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- Merge PDF Tool -->
    <section id="merge-tool" class="hidden">
      <div class="max-w-7xl mx-auto">
        <div class="text-center mb-8">
          <h2 class="text-3xl font-bold text-gray-800 mb-2">üìÑ Merge PDF Files</h2>
          <p class="text-gray-600">‡∏£‡∏ß‡∏°‡∏´‡∏•‡∏≤‡∏¢‡πÑ‡∏ü‡∏•‡πå PDF ‡πÄ‡∏õ‡πá‡∏ô‡πÑ‡∏ü‡∏•‡πå‡πÄ‡∏î‡∏µ‡∏¢‡∏ß ‡πÇ‡∏î‡∏¢‡∏£‡∏±‡∏Å‡∏©‡∏≤‡∏Ñ‡∏∏‡∏ì‡∏†‡∏≤‡∏û‡πÄ‡∏î‡∏¥‡∏°</p>
        </div>

        <div class="grid grid-cols-1 lg:grid-cols-4 gap-6">
          <!-- Main Merge Area -->
          <div class="lg:col-span-3">
            <!-- File Drop Zone -->
            <div id="merge-drop-zone" class="file-drop-zone border-2 border-dashed border-gray-300 rounded-lg p-12 text-center mb-6 cursor-pointer">
              <div class="animate-bounce-gentle mb-4">
                <div class="text-6xl text-gray-400">üìÅ</div>
              </div>
              <h3 class="text-xl font-semibold text-gray-700 mb-2">‡∏•‡∏≤‡∏Å‡πÑ‡∏ü‡∏•‡πå PDF ‡∏´‡∏£‡∏∑‡∏≠‡∏Ñ‡∏•‡∏¥‡∏Å‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏•‡∏∑‡∏≠‡∏Å</h3>
              <p class="text-gray-500 mb-4">‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö‡πÑ‡∏ü‡∏•‡πå PDF ‡∏´‡∏•‡∏≤‡∏¢‡πÑ‡∏ü‡∏•‡πå</p>
              <input type="file" id="merge-files" multiple accept=".pdf" class="hidden">
              <button onclick="document.getElementById('merge-files').click()" class="bg-red-600 text-white px-6 py-3 rounded-lg hover:bg-red-700 transition-all">
                ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÑ‡∏ü‡∏•‡πå PDF
              </button>
            </div>

            <!-- PDF Grid -->
            <div id="merge-area" class="merge-area">
              <div id="empty-state" class="text-center py-20">
                <div class="text-6xl text-gray-300 mb-4">üìÑ</div>
                <h3 class="text-lg font-medium text-gray-500 mb-2">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡πÑ‡∏ü‡∏•‡πå PDF</h3>
                <p class="text-gray-400">‡∏•‡∏≤‡∏Å‡πÑ‡∏ü‡∏•‡πå‡∏°‡∏≤‡∏ß‡∏≤‡∏á‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà ‡∏´‡∏£‡∏∑‡∏≠‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÑ‡∏ü‡∏•‡πå‡∏î‡πâ‡∏≤‡∏ô‡∏ö‡∏ô</p>
              </div>
              <div id="pdf-grid" class="pdf-grid hidden"></div>
            </div>

            <!-- Progress -->
            <div id="merge-progress" class="hidden mt-6">
              <div class="bg-gray-200 rounded-full h-4 overflow-hidden">
                <div id="merge-progress-bar" class="progress-bar bg-red-600 h-full" style="width: 0%"></div>
              </div>
              <p class="text-center text-sm text-gray-600 mt-2">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏£‡∏ß‡∏°‡πÑ‡∏ü‡∏•‡πå... <span id="merge-progress-text">0%</span></p>
            </div>

            <!-- Result -->
            <div id="merge-result" class="hidden mt-6 p-4 bg-green-50 border border-green-200 rounded-lg">
              <h3 class="text-lg font-semibold text-green-800 mb-2">‚úÖ ‡∏£‡∏ß‡∏°‡πÑ‡∏ü‡∏•‡πå‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!</h3>
              <p class="text-green-700 mb-3" id="merge-result-text"></p>
              <button onclick="downloadMergedFile()" class="bg-green-600 text-white px-6 py-2 rounded-lg hover:bg-green-700">
                üì• ‡∏î‡∏≤‡∏ß‡∏ô‡πå‡πÇ‡∏´‡∏•‡∏î‡πÑ‡∏ü‡∏•‡πå‡∏ó‡∏µ‡πà‡∏£‡∏ß‡∏°‡πÅ‡∏•‡πâ‡∏ß
              </button>
            </div>
          </div>

          <!-- Control Panel -->
          <div class="lg:col-span-1">
            <div class="control-panel">
              <h3 class="text-lg font-semibold text-gray-800 mb-4">‡∏Å‡∏≤‡∏£‡∏Ñ‡∏ß‡∏ö‡∏Ñ‡∏∏‡∏°</h3>
              
              <!-- File Count -->
              <div class="mb-6">
                <div class="text-sm text-gray-600 mb-2">‡πÑ‡∏ü‡∏•‡πå‡∏ó‡∏µ‡πà‡πÄ‡∏•‡∏∑‡∏≠‡∏Å</div>
                <div class="text-2xl font-bold text-red-600" id="file-count">0</div>
              </div>

              <!-- Order Controls -->
              <div id="order-controls" class="hidden mb-6">
                <div class="text-sm text-gray-600 mb-3">‡∏à‡∏±‡∏î‡πÄ‡∏£‡∏µ‡∏¢‡∏á‡πÑ‡∏ü‡∏•‡πå</div>
                <div class="flex flex-col gap-2">
                  <button onclick="sortFiles('name')" class="bg-gray-100 hover:bg-gray-200 px-3 py-2 rounded text-sm transition-all">
                    üìù ‡πÄ‡∏£‡∏µ‡∏¢‡∏á‡∏ï‡∏≤‡∏°‡∏ä‡∏∑‡πà‡∏≠ A-Z
                  </button>
                  <button onclick="sortFiles('size')" class="bg-gray-100 hover:bg-gray-200 px-3 py-2 rounded text-sm transition-all">
                    üìä ‡πÄ‡∏£‡∏µ‡∏¢‡∏á‡∏ï‡∏≤‡∏°‡∏Ç‡∏ô‡∏≤‡∏î
                  </button>
                  <button onclick="sortFiles('date')" class="bg-gray-100 hover:bg-gray-200 px-3 py-2 rounded text-sm transition-all">
                    üìÖ ‡πÄ‡∏£‡∏µ‡∏¢‡∏á‡∏ï‡∏≤‡∏°‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà
                  </button>
                  <button onclick="reverseOrder()" class="bg-gray-100 hover:bg-gray-200 px-3 py-2 rounded text-sm transition-all">
                    üîÑ ‡∏Å‡∏•‡∏±‡∏ö‡∏•‡∏≥‡∏î‡∏±‡∏ö
                  </button>
                </div>
              </div>

              <!-- Merge Options -->
              <div id="merge-options" class="hidden mb-6">
                <div class="text-sm text-gray-600 mb-3">‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏∑‡∏≠‡∏Å</div>
                <div class="space-y-3">
                  <label class="flex items-center text-sm">
                    <input type="checkbox" id="add-bookmarks" class="mr-2">
                    ‡πÄ‡∏û‡∏¥‡πà‡∏° Bookmarks
                  </label>
                  <label class="flex items-center text-sm">
                    <input type="checkbox" id="preserve-links" class="mr-2" checked>
                    ‡∏£‡∏±‡∏Å‡∏©‡∏≤ Links
                  </label>
                  <label class="flex items-center text-sm">
                    <input type="checkbox" id="optimize-size" class="mr-2">
                    ‡∏õ‡∏£‡∏±‡∏ö‡∏õ‡∏£‡∏∏‡∏á‡∏Ç‡∏ô‡∏≤‡∏î
                  </label>
                </div>
              </div>

              <!-- Actions -->
              <div class="space-y-3">
                <button id="merge-btn" onclick="executeMerge()" class="w-full bg-red-600 text-white py-3 rounded-lg font-semibold hover:bg-red-700 transition-all disabled:opacity-50 disabled:cursor-not-allowed" disabled>
                  üìÑ ‡∏£‡∏ß‡∏° PDF
                </button>
                <button onclick="clearAllFiles()" class="w-full bg-gray-100 text-gray-700 py-2 rounded-lg hover:bg-gray-200 transition-all" id="clear-btn" style="display: none;">
                  üóëÔ∏è ‡∏•‡∏ö‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î
                </button>
              </div>
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- Compress PDF Tool -->
    <section id="compress-tool" class="hidden">
      <div class="max-w-4xl mx-auto">
        <div class="bg-white rounded-xl shadow-lg p-8">
          <div class="text-center mb-8">
            <h2 class="text-3xl font-bold text-gray-800 mb-2">üóúÔ∏è Compress PDF</h2>
            <p class="text-gray-600">‡∏•‡∏î‡∏Ç‡∏ô‡∏≤‡∏î‡πÑ‡∏ü‡∏•‡πå PDF ‡πÇ‡∏î‡∏¢‡∏£‡∏±‡∏Å‡∏©‡∏≤‡∏Ñ‡∏∏‡∏ì‡∏†‡∏≤‡∏û‡πÉ‡∏´‡πâ‡∏î‡∏µ‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î</p>
          </div>

          <!-- File Upload -->
          <div id="compress-drop-zone" class="file-drop-zone border-2 border-dashed border-gray-300 rounded-lg p-12 text-center mb-6 cursor-pointer">
            <div class="animate-bounce-gentle mb-4">
              <div class="text-6xl text-gray-400">üóúÔ∏è</div>
            </div>
            <h3 class="text-xl font-semibold text-gray-700 mb-2">‡∏•‡∏≤‡∏Å‡πÑ‡∏ü‡∏•‡πå PDF ‡∏´‡∏£‡∏∑‡∏≠‡∏Ñ‡∏•‡∏¥‡∏Å‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏•‡∏∑‡∏≠‡∏Å</h3>
            <p class="text-gray-500 mb-4">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÑ‡∏ü‡∏•‡πå PDF ‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏ö‡∏µ‡∏ö‡∏≠‡∏±‡∏î</p>
            <input type="file" id="compress-file" accept=".pdf" class="hidden">
            <button onclick="document.getElementById('compress-file').click()" class="bg-green-600 text-white px-6 py-3 rounded-lg hover:bg-green-700 transition-all">
              ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÑ‡∏ü‡∏•‡πå PDF
            </button>
          </div>

          <!-- File Info -->
          <div id="compress-file-info" class="hidden mb-6 p-4 bg-blue-50 border border-blue-200 rounded-lg">
            <h3 class="text-lg font-semibold text-blue-800 mb-2">‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏ü‡∏•‡πå‡πÄ‡∏î‡∏¥‡∏°:</h3>
            <div id="compress-original-size" class="text-blue-700"></div>
          </div>

          <!-- Compression Options -->
          <div id="compress-options" class="hidden mb-6">
            <h3 class="text-lg font-semibold mb-4">‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏ö‡∏µ‡∏ö‡∏≠‡∏±‡∏î:</h3>
            
            <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-6">
              <div class="border-2 border-gray-200 rounded-lg p-4 cursor-pointer hover:border-green-500 transition-all" onclick="selectCompressionLevel('low')">
                <input type="radio" name="compression-level" value="low" id="compression-low" class="mb-3">
                <label for="compression-low" class="cursor-pointer">
                  <h4 class="font-semibold text-gray-800">‡∏ö‡∏µ‡∏ö‡∏≠‡∏±‡∏î‡∏ô‡πâ‡∏≠‡∏¢</h4>
                  <p class="text-sm text-gray-600">‡∏Ñ‡∏∏‡∏ì‡∏†‡∏≤‡∏û‡∏™‡∏π‡∏á, ‡∏•‡∏î‡∏Ç‡∏ô‡∏≤‡∏î 10-30%</p>
                  <div class="mt-2 text-xs text-green-600">‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç</div>
                </label>
              </div>
              
              <div class="border-2 border-green-500 bg-green-50 rounded-lg p-4 cursor-pointer" onclick="selectCompressionLevel('medium')">
                <input type="radio" name="compression-level" value="medium" id="compression-medium" class="mb-3" checked>
                <label for="compression-medium" class="cursor-pointer">
                  <h4 class="font-semibold text-gray-800">‡∏ö‡∏µ‡∏ö‡∏≠‡∏±‡∏î‡∏Å‡∏•‡∏≤‡∏á</h4>
                  <p class="text-sm text-gray-600">‡∏™‡∏°‡∏î‡∏∏‡∏•, ‡∏•‡∏î‡∏Ç‡∏ô‡∏≤‡∏î 30-60%</p>
                  <div class="mt-2 text-xs text-green-600">‚úÖ ‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥ (‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏°‡∏î‡∏∏‡∏•‡∏î‡∏µ‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î)</div>
                </label>
              </div>
              
              <div class="border-2 border-gray-200 rounded-lg p-4 cursor-pointer hover:border-green-500 transition-all" onclick="selectCompressionLevel('high')">
                <input type="radio" name="compression-level" value="high" id="compression-high" class="mb-3">
                <label for="compression-high" class="cursor-pointer">
                  <h4 class="font-semibold text-gray-800">‡∏ö‡∏µ‡∏ö‡∏≠‡∏±‡∏î‡∏™‡∏π‡∏á</h4>
                  <p class="text-sm text-gray-600">‡∏Ç‡∏ô‡∏≤‡∏î‡πÄ‡∏•‡πá‡∏Å, ‡∏•‡∏î‡∏Ç‡∏ô‡∏≤‡∏î 60-80%</p>
                  <div class="mt-2 text-xs text-green-600">‡πÄ‡∏´‡∏°‡∏≤‡∏∞‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÅ‡∏ä‡∏£‡πå‡∏≠‡∏≠‡∏ô‡πÑ‡∏•‡∏ô‡πå</div>
                </label>
              </div>
            </div>

            <!-- Advanced Options -->
            <div class="border-t pt-4">
              <h4 class="font-semibold text-gray-800 mb-3">‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏Ç‡∏±‡πâ‡∏ô‡∏™‡∏π‡∏á:</h4>
              <div class="space-y-3">
                <label class="inline-flex items-center">
                  <input type="checkbox" id="optimize-images" class="mr-2" checked>
                  <span class="text-sm">‡∏õ‡∏£‡∏±‡∏ö‡∏õ‡∏£‡∏∏‡∏á‡∏Ñ‡∏∏‡∏ì‡∏†‡∏≤‡∏û‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û</span>
                </label>
                <label class="inline-flex items-center">
                  <input type="checkbox" id="remove-metadata" class="mr-2">
                  <span class="text-sm">‡∏•‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• Metadata</span>
                </label>
                <label class="inline-flex items-center">
                  <input type="checkbox" id="linearize-pdf" class="mr-2">
                  <span class="text-sm">‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏õ‡∏£‡∏∞‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡∏†‡∏≤‡∏û‡∏Å‡∏≤‡∏£‡πÇ‡∏´‡∏•‡∏î‡∏ö‡∏ô‡πÄ‡∏ß‡πá‡∏ö</span>
                </label>
              </div>
            </div>
          </div>

          <!-- Compress Button -->
          <div class="text-center">
            <button id="compress-btn" onclick="executeCompress()" class="bg-green-600 text-white px-8 py-4 rounded-lg text-lg font-semibold hover:bg-green-700 transition-all disabled:opacity-50" disabled>
              üóúÔ∏è ‡∏ö‡∏µ‡∏ö‡∏≠‡∏±‡∏î PDF
            </button>
          </div>

          <!-- Progress -->
          <div id="compress-progress" class="hidden mt-6">
            <div class="bg-gray-200 rounded-full h-4 overflow-hidden">
              <div id="compress-progress-bar" class="progress-bar bg-green-600 h-full" style="width: 0%"></div>
            </div>
            <p class="text-center text-sm text-gray-600 mt-2">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ö‡∏µ‡∏ö‡∏≠‡∏±‡∏î‡πÑ‡∏ü‡∏•‡πå... <span id="compress-progress-text">0%</span></p>
          </div>

          <!-- Result -->
          <div id="compress-result" class="hidden mt-6 p-4 bg-green-50 border border-green-200 rounded-lg">
            <h3 class="text-lg font-semibold text-green-800 mb-2">‚úÖ ‡∏ö‡∏µ‡∏ö‡∏≠‡∏±‡∏î‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!</h3>
            <div id="compress-stats" class="text-green-700 mb-3"></div>
            <button onclick="downloadCompressedFile()" class="bg-green-600 text-white px-6 py-2 rounded-lg hover:bg-green-700">
              üì• ‡∏î‡∏≤‡∏ß‡∏ô‡πå‡πÇ‡∏´‡∏•‡∏î‡πÑ‡∏ü‡∏•‡πå‡∏ó‡∏µ‡πà‡∏ö‡∏µ‡∏ö‡∏≠‡∏±‡∏î‡πÅ‡∏•‡πâ‡∏ß
            </button>
          </div>
        </div>
      </div>
    </section>

  </main>

  <!-- JavaScript -->
  <script>
    // Global Variables
    let currentTool = null;
    let processedFiles = [];
    let mergedPdfBlob = null;
    let compressedPdfBlob = null;
    let mergeFiles = [];
    let draggedElement = null;
    let currentSplitTab = 'pages';
    let currentRangeMode = 'custom';
    let rangeCounter = 1;
    let pdfDocument = null;
    let selectedPages = new Set();
    let totalPages = 0;

    // Edit PDF Variables
    const PDF_FONTS = [
      "Sarabun","Prompt","Kanit","Mitr","Maitree","Pridi","Sriracha","Srisakdi","Taviraj","Niramit","Chonburi","Charmonman","Charm","Pattaya","Bai Jamjuree","Mali","Sura","Noto Sans Thai","Noto Serif Thai",
      "Arial","Times New Roman","Helvetica","Courier New","Georgia","Verdana","Trebuchet MS","Comic Sans MS","Impact","Lucida Console"
    ];
    let editFabricCanvas = null;
    let editTool = 'select';
    let editPdfPages = [];
    let editPageNum = 0;
    let editScale = 1;
    let editPdfLoaded = false;
    let editHistory = [];
    let editRedoStack = [];
    let maxEditHistory = 50;
    let editPdfW = 800;
    let editPdfH = 1132;
    let editPdfImages = [];
    let editIsDrawing = false;
    let editStartX = 0;
    let editStartY = 0;
    let editCurrentObject = null;

    // Initialize PDF.js
    if (typeof pdfjsLib !== 'undefined') {
      pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.worker.min.js';
    }

    // Navigation Functions
    function goBack() {
      if (currentTool) {
        showGrid();
      } else {
        window.history.back();
      }
    }

    function showGrid() {
      const gridElement = document.getElementById('pdf-tools-grid');
      if (gridElement) {
        gridElement.classList.remove('hidden');
      }
      
      document.querySelectorAll('[id$="-tool"]').forEach(tool => {
        tool.classList.add('hidden');
      });
      currentTool = null;
      window.history.pushState({}, '', '#pdftools');
    }

    function openTool(toolName) {
      console.log('Opening tool:', toolName);
      const gridElement = document.getElementById('pdf-tools-grid');
      if (gridElement) {
        gridElement.classList.add('hidden');
      }
      
      document.querySelectorAll('[id$="-tool"]').forEach(tool => {
        tool.classList.add('hidden');
      });
      
      const toolElement = document.getElementById(`${toolName}-tool`);
      if (toolElement) {
        toolElement.classList.remove('hidden');
        currentTool = toolName;
        window.history.pushState({}, '', `#pdftools-${toolName}`);
        console.log('Tool opened successfully:', toolName);
        
        // Initialize edit tool if needed
        if (toolName === 'edit') {
          initializeEditTool();
        }
      } else {
        alert(`‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏°‡∏∑‡∏≠ ${toolName} ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏û‡∏±‡∏í‡∏ô‡∏≤ ‡∏à‡∏∞‡πÄ‡∏õ‡∏¥‡∏î‡πÉ‡∏´‡πâ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡πÄ‡∏£‡πá‡∏ß‡πÜ ‡∏ô‡∏µ‡πâ`);
      }
    }

    // Edit PDF Functions
    function initializeEditTool() {
      if (!editFabricCanvas) {
        editFabricCanvas = new fabric.Canvas('edit-fabric-canvas', { 
          backgroundColor: null, 
          preserveObjectStacking: true, 
          selection: true 
        });
        
        // Setup edit listeners
        setupEditListeners();
        setEditTool('select');
        
        // Save initial state
        saveEditState();
      }
    }

    function setupEditListeners() {
      const fileInput = document.getElementById('edit-file-input');
      const dropZone = document.getElementById('edit-drop-zone');
      
      if (fileInput) {
        fileInput.addEventListener('change', handleEditFile);
      }
      
      if (dropZone) {
        dropZone.addEventListener('dragover', (e) => {
          e.preventDefault();
          dropZone.classList.add('dragover');
        });
        
        dropZone.addEventListener('dragleave', () => {
          dropZone.classList.remove('dragover');
        });
        
        dropZone.addEventListener('drop', (e) => {
          e.preventDefault();
          dropZone.classList.remove('dragover');
          const files = Array.from(e.dataTransfer.files).filter(f => f.type === 'application/pdf');
          if (files.length === 1 && fileInput) {
            const dt = new DataTransfer();
            files.forEach(file => dt.items.add(file));
            fileInput.files = dt.files;
            handleEditFile({ target: fileInput });
          }
        });
      }

      // Event listeners for free drawing (highlight & signature)
      editFabricCanvas.on('path:created', function(e) {
        saveEditState();
        setTimeout(() => {
          setEditTool('select');
          editFabricCanvas.setActiveObject(e.path);
          editFabricCanvas.requestRenderAll();
        }, 100);
      });

      // Mouse events for creating objects
      editFabricCanvas.on('mouse:down', function(opt) {
        if (editTool === 'select' || editTool === 'highlight' || editTool === 'signature') return;
        
        editIsDrawing = true;
        editStartX = opt.pointer.x;
        editStartY = opt.pointer.y;
        
        if (editTool === 'text') {
          editCurrentObject = new fabric.Textbox('‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°', { 
            left: editStartX, 
            top: editStartY, 
            width: 0,
            fontFamily: 'Sarabun', 
            fontSize: 32, 
            fill: '#000',
            backgroundColor: 'rgba(255,255,255,0.8)',
            borderColor: '#333',
            cornerColor: '#333'
          });
          editFabricCanvas.add(editCurrentObject);
          editFabricCanvas.requestRenderAll();
        } else if (editTool === 'image') {
          let input = document.createElement('input');
          input.type = 'file';
          input.accept = 'image/*';
          input.onchange = e => {
            let reader = new FileReader();
            reader.onload = ev => fabric.Image.fromURL(ev.target.result, img => {
              editFabricCanvas.add(img.set({ 
                left: editStartX, 
                top: editStartY, 
                scaleX: 0.3, 
                scaleY: 0.3 
              })).setActiveObject(img);
              saveEditState();
              setEditTool('select');
            });
            reader.readAsDataURL(e.target.files[0]);
          };
          input.click();
          editIsDrawing = false;
        } else {
          if (editTool === 'rect') {
            editCurrentObject = new fabric.Rect({ 
              left: editStartX, 
              top: editStartY, 
              width: 0, 
              height: 0, 
              fill: 'rgba(255,255,0,0.18)', 
              stroke: '#333', 
              strokeWidth: 2 
            });
          } else if (editTool === 'circle') {
            editCurrentObject = new fabric.Circle({ 
              left: editStartX, 
              top: editStartY, 
              radius: 0, 
              fill: 'rgba(0,255,255,0.16)', 
              stroke: '#222', 
              strokeWidth: 2 
            });
          } else if (editTool === 'line') {
            editCurrentObject = new fabric.Line([editStartX, editStartY, editStartX, editStartY], { 
              stroke: '#333', 
              strokeWidth: 3 
            });
          }
          
          if (editCurrentObject) {
            editFabricCanvas.add(editCurrentObject);
            editFabricCanvas.requestRenderAll();
          }
        }
      });

      editFabricCanvas.on('mouse:move', function(opt) {
        if (!editIsDrawing || !editCurrentObject) return;
        
        let pointer = opt.pointer;
        let width = pointer.x - editStartX;
        let height = pointer.y - editStartY;
        
        if (editTool === 'text') {
          editCurrentObject.set({
            width: Math.abs(width) > 50 ? Math.abs(width) : 50,
            left: width > 0 ? editStartX : pointer.x,
            top: height > 0 ? editStartY : pointer.y
          });
        } else if (editTool === 'rect') {
          editCurrentObject.set({
            width: Math.abs(width),
            height: Math.abs(height),
            left: width > 0 ? editStartX : pointer.x,
            top: height > 0 ? editStartY : pointer.y
          });
        } else if (editTool === 'circle') {
          let radius = Math.sqrt(width * width + height * height) / 2;
          editCurrentObject.set({
            radius: radius,
            left: editStartX - radius,
            top: editStartY - radius
          });
        } else if (editTool === 'line') {
          editCurrentObject.set({
            x2: pointer.x,
            y2: pointer.y
          });
        }
        
        editFabricCanvas.requestRenderAll();
      });

      editFabricCanvas.on('mouse:up', function(opt) {
        if (!editIsDrawing) return;
        
        editIsDrawing = false;
        
        if (editCurrentObject) {
          let shouldRemove = false;
          
          if (editTool === 'text' && editCurrentObject.width < 50) {
            shouldRemove = true;
          } else if (editTool === 'rect' && (editCurrentObject.width < 5 || editCurrentObject.height < 5)) {
            shouldRemove = true;
          } else if (editTool === 'circle' && editCurrentObject.radius < 3) {
            shouldRemove = true;
          } else if (editTool === 'line') {
            let distance = Math.sqrt(Math.pow(editCurrentObject.x2 - editCurrentObject.x1, 2) + Math.pow(editCurrentObject.y2 - editCurrentObject.y1, 2));
            if (distance < 5) shouldRemove = true;
          }
          
          if (shouldRemove) {
            editFabricCanvas.remove(editCurrentObject);
          } else {
            editFabricCanvas.setActiveObject(editCurrentObject);
            saveEditState();
            setEditTool('select');
          }
          
          editCurrentObject = null;
          editFabricCanvas.requestRenderAll();
        }
      });

      // Object modification listeners
      editFabricCanvas.on('object:modified', saveEditState);
      editFabricCanvas.on('object:removed', saveEditState);
      editFabricCanvas.on('selection:created', updateEditProps);
      editFabricCanvas.on('selection:updated', updateEditProps);
      editFabricCanvas.on('selection:cleared', updateEditProps);

      // Keyboard shortcuts
      document.addEventListener('keydown', e => {
        if (!editFabricCanvas || currentTool !== 'edit') return;
        
        let activeElement = document.activeElement;
        if (activeElement && (activeElement.tagName === 'INPUT' || activeElement.tagName === 'TEXTAREA')) {
          return;
        }
        
        if (e.key === 'Escape') {
          setEditTool('select');
        } else if (e.key === 'Delete' || e.key === 'Backspace') {
          e.preventDefault();
          deleteActiveEditObject();
        } else if (e.ctrlKey && e.key === 'z') {
          e.preventDefault();
          editUndo();
        } else if (e.ctrlKey && e.key === 'y') {
          e.preventDefault();
          editRedo();
        }
      });
    }

    function setEditTool(t) {
      editTool = t;
      editFabricCanvas.isDrawingMode = (t === 'highlight' || t === 'signature');
      document.querySelectorAll('#edit-tool .toolbar-btn').forEach(btn => btn.classList.remove('active'));
      let btn = document.getElementById('edit_tool_' + t);
      if (btn) btn.classList.add('active');
      
      if (t !== 'select') {
        editFabricCanvas.discardActiveObject();
        editFabricCanvas.requestRenderAll();
      }
      
      if (t === 'highlight') {
        editFabricCanvas.freeDrawingBrush = new fabric.PencilBrush(editFabricCanvas);
        editFabricCanvas.freeDrawingBrush.width = 20;
        editFabricCanvas.freeDrawingBrush.color = "rgba(255,255,0,0.3)";
      }
      if (t === 'signature') {
        editFabricCanvas.freeDrawingBrush = new fabric.PencilBrush(editFabricCanvas);
        editFabricCanvas.freeDrawingBrush.width = 4;
        editFabricCanvas.freeDrawingBrush.color = "#111";
      }
    }

    async function handleEditFile(e) {
      const file = e.target.files[0];
      if (!file) return;
      
      try {
        const ab = await file.arrayBuffer();
        const pdf = await pdfjsLib.getDocument({ data: ab }).promise;
        editPdfPages = [];
        editPdfImages = [];
        
        for (let i = 1; i <= pdf.numPages; i++) {
          let page = await pdf.getPage(i);
          editPdfPages.push(page);
          
          let viewport = page.getViewport({ scale: 1.0 });
          let c = document.createElement('canvas');
          c.width = viewport.width;
          c.height = viewport.height;
          let ctx = c.getContext('2d');
          await page.render({ canvasContext: ctx, viewport: viewport }).promise;
          editPdfImages.push(c.toDataURL("image/png"));
        }
        
        editPageNum = 0;
        editScale = 1;
        editPdfLoaded = true;
        
        // Hide drop zone and show canvas
        const dropZone = document.getElementById('edit-drop-zone');
        if (dropZone) dropZone.style.display = 'none';
        
        renderEditPage();
      } catch (error) {
        console.error('Error opening PDF:', error);
        alert('‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏õ‡∏¥‡∏î‡πÑ‡∏ü‡∏•‡πå PDF ‡πÑ‡∏î‡πâ');
      }
    }

    async function openEditPdf(input) {
      await handleEditFile({ target: input });
    }

    function renderEditPage() {
      if (!editPdfLoaded || !editPdfImages[editPageNum]) return;
      
      let imgUrl = editPdfImages[editPageNum];
      let c = document.getElementById('edit-fabric-canvas');
      let img = new window.Image();
      
      img.onload = function() {
        editPdfW = img.width * editScale;
        editPdfH = img.height * editScale;
        c.width = editPdfW;
        c.height = editPdfH;
        editFabricCanvas.setWidth(editPdfW);
        editFabricCanvas.setHeight(editPdfH);
        
        fabric.Image.fromURL(imgUrl, function(bgImg) {
          editFabricCanvas.setBackgroundImage(bgImg, editFabricCanvas.renderAll.bind(editFabricCanvas), {
            scaleX: editPdfW / img.width,
            scaleY: editPdfH / img.height
          });
        });
        
        document.getElementById('edit-page-view').innerText = (editPageNum + 1) + "/" + editPdfPages.length;
        document.getElementById('edit-zoom-view').innerText = Math.round(editScale * 100) + "%";
      };
      
      img.src = imgUrl;
    }

    function prevEditPage() {
      if (editPageNum > 0) {
        editPageNum--;
        renderEditPage();
      }
    }

    function nextEditPage() {
      if (editPdfPages.length > 0 && editPageNum < editPdfPages.length - 1) {
        editPageNum++;
        renderEditPage();
      }
    }

    function editZoom(delta) {
      editScale = Math.max(0.25, Math.min(2.5, editScale + delta * 0.1));
      renderEditPage();
    }

    function saveEditState() {
      if (editHistory.length > maxEditHistory) editHistory.shift();
      editHistory.push(JSON.stringify(editFabricCanvas));
      editRedoStack = [];
    }

    function editUndo() {
      if (editHistory.length > 1) {
        editRedoStack.push(editHistory.pop());
        editFabricCanvas.loadFromJSON(editHistory[editHistory.length - 1], () => {
          editFabricCanvas.renderAll();
          updateEditProps();
        });
      }
    }

    function editRedo() {
      if (editRedoStack.length) {
        let s = editRedoStack.pop();
        editHistory.push(s);
        editFabricCanvas.loadFromJSON(s, () => {
          editFabricCanvas.renderAll();
          updateEditProps();
        });
      }
    }

    function updateEditProps() {
      let obj = editFabricCanvas.getActiveObject();
      let p = document.getElementById('edit-prop-panel');
      if (!obj) {
        p.innerHTML = '<span class="text-gray-400">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏î‡∏π‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î</span>';
        return;
      }
      
      let html = '';
      
      if (obj.type === 'i-text' || obj.type === 'textbox' || obj.type === 'text') {
        html += `<label>‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏° <input type="text" value="${obj.text || ''}" oninput="editFabricCanvas.getActiveObject().set('text',this.value);editFabricCanvas.requestRenderAll();"></label>
        <label>Font <select onchange="editFabricCanvas.getActiveObject().set('fontFamily',this.value);editFabricCanvas.requestRenderAll();">
          ${PDF_FONTS.map(f => `<option value="${f}"${obj.fontFamily === f ? ' selected' : ''}>${f}</option>`).join('')}
        </select></label>
        <label>‡∏Ç‡∏ô‡∏≤‡∏î <input type="number" value="${obj.fontSize || 32}" min="8" max="144" oninput="editFabricCanvas.getActiveObject().set('fontSize',parseInt(this.value));editFabricCanvas.requestRenderAll();"></label>
        <label>‡∏™‡∏µ <input type="color" value="${obj.fill || '#000000'}" onchange="editFabricCanvas.getActiveObject().set('fill',this.value);editFabricCanvas.requestRenderAll();"></label>
        <label><input type="checkbox" ${obj.fontWeight === 'bold' ? 'checked' : ''} onchange="editFabricCanvas.getActiveObject().set('fontWeight',this.checked?'bold':'normal');editFabricCanvas.requestRenderAll();"> Bold</label>
        <label><input type="checkbox" ${obj.fontStyle === 'italic' ? 'checked' : ''} onchange="editFabricCanvas.getActiveObject().set('fontStyle',this.checked?'italic':'normal');editFabricCanvas.requestRenderAll();"> Italic</label>
        <label><input type="checkbox" ${obj.underline ? 'checked' : ''} onchange="editFabricCanvas.getActiveObject().set('underline',this.checked);editFabricCanvas.requestRenderAll();"> Underline</label>
        <label>Align <select onchange="editFabricCanvas.getActiveObject().set('textAlign',this.value);editFabricCanvas.requestRenderAll();">
          <option value="left"${obj.textAlign === 'left' ? ' selected' : ''}>‡∏ã‡πâ‡∏≤‡∏¢</option>
          <option value="center"${obj.textAlign === 'center' ? ' selected' : ''}>‡∏Å‡∏•‡∏≤‡∏á</option>
          <option value="right"${obj.textAlign === 'right' ? ' selected' : ''}>‡∏Ç‡∏ß‡∏≤</option>
        </select></label>`;
      } else if (obj.type === 'path') {
        let strokeColor = obj.stroke || '#000000';
        if (typeof strokeColor === 'string' && strokeColor.includes('rgba')) {
          strokeColor = '#ffff00';
        }
        html += `<label>‡∏™‡∏µ‡πÄ‡∏™‡πâ‡∏ô <input type="color" value="${strokeColor}" onchange="editFabricCanvas.getActiveObject().set('stroke',this.value);editFabricCanvas.requestRenderAll();"></label>
        <label>‡∏Ñ‡∏ß‡∏≤‡∏°‡∏´‡∏ô‡∏≤ <input type="range" min="1" max="50" value="${obj.strokeWidth || 4}" oninput="editFabricCanvas.getActiveObject().set('strokeWidth',parseInt(this.value));editFabricCanvas.requestRenderAll();"> <span>${obj.strokeWidth || 4}px</span></label>
        <label>‡∏Ñ‡∏ß‡∏≤‡∏°‡πÇ‡∏õ‡∏£‡πà‡∏á‡πÉ‡∏™ <input type="range" min="0.1" max="1" step="0.1" value="${obj.opacity || 1}" oninput="editFabricCanvas.getActiveObject().set('opacity',parseFloat(this.value));editFabricCanvas.requestRenderAll();"> <span>${Math.round((obj.opacity || 1) * 100)}%</span></label>`;
      } else if (obj.type === 'rect' || obj.type === 'circle') {
        html += `<label>‡∏™‡∏µ‡∏û‡∏∑‡πâ‡∏ô <input type="color" value="${obj.fill || '#ffffff'}" onchange="editFabricCanvas.getActiveObject().set('fill',this.value);editFabricCanvas.requestRenderAll();"></label>
        <label>‡∏™‡∏µ‡∏Ç‡∏≠‡∏ö <input type="color" value="${obj.stroke || '#000000'}" onchange="editFabricCanvas.getActiveObject().set('stroke',this.value);editFabricCanvas.requestRenderAll();"></label>
        <label>‡∏Ñ‡∏ß‡∏≤‡∏°‡∏´‡∏ô‡∏≤‡∏Ç‡∏≠‡∏ö <input type="number" min="0" max="20" value="${obj.strokeWidth || 2}" oninput="editFabricCanvas.getActiveObject().set('strokeWidth',parseInt(this.value));editFabricCanvas.requestRenderAll();"></label>`;
      } else if (obj.type === 'line') {
        html += `<label>‡∏™‡∏µ‡πÄ‡∏™‡πâ‡∏ô <input type="color" value="${obj.stroke || '#000000'}" onchange="editFabricCanvas.getActiveObject().set('stroke',this.value);editFabricCanvas.requestRenderAll();"></label>
        <label>‡∏Ñ‡∏ß‡∏≤‡∏°‡∏´‡∏ô‡∏≤ <input type="number" min="1" max="20" value="${obj.strokeWidth || 3}" oninput="editFabricCanvas.getActiveObject().set('strokeWidth',parseInt(this.value));editFabricCanvas.requestRenderAll();"></label>`;
      }
      
      html += `<label>X <input type="number" value="${Math.round(obj.left || 0)}" oninput="editFabricCanvas.getActiveObject().set('left',parseInt(this.value));editFabricCanvas.requestRenderAll();"></label>
      <label>Y <input type="number" value="${Math.round(obj.top || 0)}" oninput="editFabricCanvas.getActiveObject().set('top',parseInt(this.value));editFabricCanvas.requestRenderAll();"></label>`;
      
      if (obj.type !== 'line' && obj.type !== 'path') {
        html += `<label>W <input type="number" value="${Math.round(obj.width || 0)}" oninput="editFabricCanvas.getActiveObject().set('width',parseInt(this.value));editFabricCanvas.requestRenderAll();"></label>
        <label>H <input type="number" value="${Math.round(obj.height || 0)}" oninput="editFabricCanvas.getActiveObject().set('height',parseInt(this.value));editFabricCanvas.requestRenderAll();"></label>`;
      }
      
      html += `<button class="bg-red-500 px-3 py-1 rounded text-white mt-3" onclick="deleteActiveEditObject()">‡∏•‡∏ö‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏</button>`;
      p.innerHTML = html;
    }

    function deleteActiveEditObject() {
      let obj = editFabricCanvas.getActiveObject();
      if (obj) {
        editFabricCanvas.remove(obj);
        editFabricCanvas.discardActiveObject();
        editFabricCanvas.requestRenderAll();
        updateEditProps();
      }
    }

    async function saveEditedPdf() {
      if (!editPdfLoaded) {
        alert('‡∏ï‡πâ‡∏≠‡∏á‡πÄ‡∏õ‡∏¥‡∏î PDF ‡∏Å‡πà‡∏≠‡∏ô');
        return;
      }
      
      try {
        const pdfDoc = await PDFLib.PDFDocument.create();
        let dataUrl = editFabricCanvas.toDataURL({ format: "png" });
        let imgEmbed = await pdfDoc.embedPng(dataUrl);
        let page = pdfDoc.addPage([editPdfW, editPdfH]);
        page.drawImage(imgEmbed, { x: 0, y: 0, width: editPdfW, height: editPdfH });
        const bytes = await pdfDoc.save();
        let blob = new Blob([bytes], { type: 'application/pdf' });
        let a = document.createElement('a');
        a.href = URL.createObjectURL(blob);
        a.download = "edited.pdf";
        a.click();
        URL.revokeObjectURL(a.href);
      } catch (error) {
        console.error('Error saving PDF:', error);
        alert('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å PDF');
      }
    }

    // Split PDF Functions
    function switchSplitTab(tab) {
      console.log('Switching to tab:', tab);
      currentSplitTab = tab;
      
      // Update tab buttons
      const tabs = ['range', 'pages', 'size'];
      tabs.forEach(tabName => {
        const tabBtn = document.getElementById(`tab-${tabName}`);
        if (tabBtn) {
          if (tabName === tab) {
            tabBtn.className = 'flex-1 py-2 px-3 rounded-md bg-white shadow text-red-600 font-medium text-sm transition-all';
          } else {
            tabBtn.className = 'flex-1 py-2 px-3 rounded-md text-gray-600 font-medium text-sm transition-all hover:bg-gray-50';
          }
        }
      });
      
      // Show/hide content
      const rangeContent = document.getElementById('range-tab-content');
      const pagesContent = document.getElementById('pages-tab-content');
      const sizeContent = document.getElementById('size-tab-content');
      
      if (rangeContent) rangeContent.style.display = tab === 'range' ? 'block' : 'none';
      if (pagesContent) pagesContent.style.display = tab === 'pages' ? 'block' : 'none';
      if (sizeContent) sizeContent.style.display = tab === 'size' ? 'block' : 'none';
    }

    async function handleSplitFile(e) {
      const file = e.target.files[0];
      const pagesContainer = document.getElementById('pdf-pages-container');
      const splitBtn = document.getElementById('split-btn');
      
      if (file) {
        try {
          const arrayBuffer = await file.arrayBuffer();
          if (typeof PDFLib !== 'undefined') {
            pdfDocument = await PDFLib.PDFDocument.load(arrayBuffer);
            totalPages = pdfDocument.getPageCount();
          } else {
            console.error('PDFLib not loaded');
            alert('PDF library not loaded');
            return;
          }
          
          // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏ü‡∏•‡πå
          const fileDetails = document.getElementById('split-file-details');
          if (fileDetails) {
            fileDetails.innerHTML = `
              <strong>${file.name}</strong> ‚Ä¢ ${(file.size / 1024 / 1024).toFixed(2)} MB ‚Ä¢ ${totalPages} ‡∏´‡∏ô‡πâ‡∏≤
            `;
          }
          
          // Update range inputs max values
          const range1To = document.getElementById('range1-to');
          const range1From = document.getElementById('range1-from');
          if (range1To) {
            range1To.max = totalPages;
            range1To.value = Math.min(2, totalPages);
          }
          if (range1From) {
            range1From.max = totalPages;
          }
          
          if (pagesContainer) pagesContainer.classList.remove('hidden');
          if (splitBtn) splitBtn.disabled = false;
          
          // ‡∏™‡∏£‡πâ‡∏≤‡∏á PDF page thumbnails
          await generatePdfPageThumbnails(file);
          
          // ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡∏î‡πâ‡∏ß‡∏¢‡∏Å‡∏≤‡∏£‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ó‡∏∏‡∏Å‡∏´‡∏ô‡πâ‡∏≤
          selectAllPages();
          
        } catch (error) {
          console.error('Error reading PDF:', error);
          alert('‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏≠‡πà‡∏≤‡∏ô‡πÑ‡∏ü‡∏•‡πå PDF ‡πÑ‡∏î‡πâ');
        }
      } else {
        if (pagesContainer) pagesContainer.classList.add('hidden');
        if (splitBtn) splitBtn.disabled = true;
      }
    }

    async function generatePdfPageThumbnails(file) {
      try {
        const arrayBuffer = await file.arrayBuffer();
        if (typeof pdfjsLib === 'undefined') {
          console.error('PDF.js not loaded');
          return;
        }
        
        const pdf = await pdfjsLib.getDocument({ data: arrayBuffer }).promise;
        const pagesGrid = document.getElementById('pdf-pages-grid');
        
        if (pagesGrid) {
          pagesGrid.innerHTML = '';
        }
        selectedPages.clear();
        
        for (let pageNum = 1; pageNum <= totalPages; pageNum++) {
          const page = await pdf.getPage(pageNum);
          const viewport = page.getViewport({ scale: 0.5 });
          
          const canvas = document.createElement('canvas');
          const context = canvas.getContext('2d');
          canvas.height = viewport.height;
          canvas.width = viewport.width;
          
          await page.render({
            canvasContext: context,
            viewport: viewport
          }).promise;
          
          // ‡∏™‡∏£‡πâ‡∏≤‡∏á page item
          const pageItem = document.createElement('div');
          pageItem.className = 'pdf-page-item';
          pageItem.dataset.pageNumber = pageNum;
          pageItem.onclick = () => togglePageSelection(pageNum);
          
          pageItem.innerHTML = `
            <canvas class="pdf-page-canvas"></canvas>
            <div class="page-number-badge">${pageNum}</div>
            <div class="selection-indicator"></div>
          `;
          
          // ‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å canvas
          const displayCanvas = pageItem.querySelector('.pdf-page-canvas');
          displayCanvas.width = canvas.width;
          displayCanvas.height = canvas.height;
          const displayContext = displayCanvas.getContext('2d');
          displayContext.drawImage(canvas, 0, 0);
          
          if (pagesGrid) {
            pagesGrid.appendChild(pageItem);
          }
        }
        
      } catch (error) {
        console.error('Error generating thumbnails:', error);
      }
    }

    function togglePageSelection(pageNumber) {
      const pageItem = document.querySelector(`[data-page-number="${pageNumber}"]`);
      
      if (selectedPages.has(pageNumber)) {
        selectedPages.delete(pageNumber);
        if (pageItem) pageItem.classList.remove('selected');
      } else {
        selectedPages.add(pageNumber);
        if (pageItem) pageItem.classList.add('selected');
      }
      
      updateSelectedInfo();
      updateExtractMode();
    }

    function selectAllPages() {
      selectedPages.clear();
      for (let i = 1; i <= totalPages; i++) {
        selectedPages.add(i);
      }
      
      document.querySelectorAll('.pdf-page-item').forEach(item => {
        item.classList.add('selected');
      });
      
      updateSelectedInfo();
      updateExtractMode();
    }

    function deselectAllPages() {
      selectedPages.clear();
      
      document.querySelectorAll('.pdf-page-item').forEach(item => {
        item.classList.remove('selected');
      });
      
      updateSelectedInfo();
      updateExtractMode();
    }

    function updateSelectedInfo() {
      const selectedCount = selectedPages.size;
      const selectedCountEl = document.getElementById('selected-count');
      const filesCountEl = document.getElementById('files-count');
      
      if (selectedCountEl && filesCountEl) {
        if (selectedCount === 0) {
          selectedCountEl.textContent = 'No pages selected.';
          filesCountEl.textContent = '0 PDF will be created.';
        } else if (selectedCount === totalPages) {
          selectedCountEl.textContent = 'All pages selected. Each page will be converted into separate PDF files.';
          filesCountEl.textContent = `${selectedCount} PDF will be created.`;
        } else {
          selectedCountEl.textContent = `${selectedCount} pages selected. Each page will be converted into separate PDF files.`;
          filesCountEl.textContent = `${selectedCount} PDF will be created.`;
        }
      }
    }

    function updateExtractMode() {
      const extractModeRadios = document.querySelectorAll('input[name="extract-mode"]');
      if (extractModeRadios.length >= 2) {
        const allRadio = extractModeRadios[0];
        const selectedRadio = extractModeRadios[1];
        
        if (selectedPages.size === totalPages) {
          allRadio.checked = true;
          allRadio.parentElement.classList.add('active');
          selectedRadio.parentElement.classList.remove('active');
        } else {
          selectedRadio.checked = true;
          selectedRadio.parentElement.classList.add('active');
          allRadio.parentElement.classList.remove('active');
        }
      }
    }

    // Event listeners ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö extract mode
    function setupExtractModeListeners() {
      const extractModeRadios = document.querySelectorAll('input[name="extract-mode"]');
      
      extractModeRadios.forEach(radio => {
        radio.addEventListener('change', (e) => {
          // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï visual state
          extractModeRadios.forEach(r => {
            r.parentElement.classList.remove('active');
          });
          e.target.parentElement.classList.add('active');
          
          // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏Å‡∏≤‡∏£‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏´‡∏ô‡πâ‡∏≤
          if (e.target.value === 'all') {
            selectAllPages();
          }
        });
      });
    }

    function selectRangeMode(mode) {
      console.log('Selecting range mode:', mode);
      currentRangeMode = mode;
      
      // Update buttons
      const customBtn = document.getElementById('custom-ranges-btn');
      const fixedBtn = document.getElementById('fixed-ranges-btn');
      
      if (customBtn && fixedBtn) {
        if (mode === 'custom') {
          customBtn.className = 'flex-1 py-2 px-3 text-sm border-2 border-red-500 bg-red-50 text-red-600 rounded-lg font-medium';
          fixedBtn.className = 'flex-1 py-2 px-3 text-sm border-2 border-gray-200 text-gray-600 rounded-lg hover:border-red-200';
        } else {
          customBtn.className = 'flex-1 py-2 px-3 text-sm border-2 border-gray-200 text-gray-600 rounded-lg hover:border-red-200';
          fixedBtn.className = 'flex-1 py-2 px-3 text-sm border-2 border-red-500 bg-red-50 text-red-600 rounded-lg font-medium';
        }
      }
      
      // Show/hide content
      const customContent = document.getElementById('custom-ranges-content');
      const fixedContent = document.getElementById('fixed-ranges-content');
      
      if (customContent) customContent.style.display = mode === 'custom' ? 'block' : 'none';
      if (fixedContent) fixedContent.style.display = mode === 'fixed' ? 'block' : 'none';
    }

    function addRange() {
      console.log('Adding range:', rangeCounter + 1);
      rangeCounter++;
      const container = document.getElementById('additional-ranges');
      
      if (container) {
        const rangeDiv = document.createElement('div');
        rangeDiv.className = 'mb-4';
        rangeDiv.id = `range-${rangeCounter}`;
        rangeDiv.innerHTML = `
          <div class="flex items-center justify-between mb-2">
            <span class="text-sm font-medium text-gray-700">üìä Range ${rangeCounter}</span>
            <button onclick="removeRange(${rangeCounter})" class="text-red-500 hover:text-red-700 text-sm">‚úï</button>
          </div>
          <div class="grid grid-cols-2 gap-2 mb-2">
            <div>
              <label class="block text-xs text-gray-500 mb-1">from page</label>
              <input type="number" id="range${rangeCounter}-from" class="w-full p-2 border border-gray-300 rounded text-center" min="1" value="1">
            </div>
            <div>
              <label class="block text-xs text-gray-500 mb-1">to</label>
              <input type="number" id="range${rangeCounter}-to" class="w-full p-2 border border-gray-300 rounded text-center" min="1" value="2">
            </div>
          </div>
        `;
        
        container.appendChild(rangeDiv);
      }
    }

    function removeRange(rangeNum) {
      console.log('Removing range:', rangeNum);
      const element = document.getElementById(`range-${rangeNum}`);
      if (element) {
        element.remove();
      }
    }

    function setupSplitListeners() {
      const fileInput = document.getElementById('split-file');
      const dropZone = document.getElementById('split-drop-zone');
      
      if (fileInput) {
        fileInput.addEventListener('change', handleSplitFile);
      }
      
      if (dropZone) {
        // Drop zone setup
        dropZone.addEventListener('dragover', (e) => {
          e.preventDefault();
          dropZone.classList.add('dragover');
        });
        
        dropZone.addEventListener('dragleave', () => {
          dropZone.classList.remove('dragover');
        });
        
        dropZone.addEventListener('drop', (e) => {
          e.preventDefault();
          dropZone.classList.remove('dragover');
          const files = Array.from(e.dataTransfer.files).filter(f => f.type === 'application/pdf');
          if (files.length === 1 && fileInput) {
            const dt = new DataTransfer();
            files.forEach(file => dt.items.add(file));
            fileInput.files = dt.files;
            handleSplitFile({ target: fileInput });
          }
        });
      }
      
      // Setup extract mode listeners
      setupExtractModeListeners();
    }

    async function executeSplit() {
      if (!pdfDocument) {
        alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÑ‡∏ü‡∏•‡πå PDF');
        return;
      }
      
      const progress = document.getElementById('split-progress');
      const progressBar = document.getElementById('split-progress-bar');
      const progressText = document.getElementById('split-progress-text');
      const result = document.getElementById('split-result');
      
      try {
        if (progress) progress.classList.remove('hidden');
        if (result) result.classList.add('hidden');
        
        let splitTasks = [];
        
        switch(currentSplitTab) {
          case 'pages':
            // ‡πÅ‡∏¢‡∏Å‡∏ï‡∏≤‡∏°‡∏´‡∏ô‡πâ‡∏≤‡∏ó‡∏µ‡πà‡πÄ‡∏•‡∏∑‡∏≠‡∏Å
            if (selectedPages.size === 0) {
              alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏´‡∏ô‡πâ‡∏≤‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡πÅ‡∏¢‡∏Å');
              if (progress) progress.classList.add('hidden');
              return;
            }
            
            const selectedPagesArray = Array.from(selectedPages).sort((a, b) => a - b);
            selectedPagesArray.forEach(pageNum => {
              splitTasks.push({
                pages: [pageNum - 1], // PDF-lib ‡πÉ‡∏ä‡πâ 0-based index
                filename: `page-${pageNum}.pdf`
              });
            });
            break;
            
          case 'range':
            if (currentRangeMode === 'custom') {
              // Handle custom ranges
              const ranges = getAllRanges();
              const mergeRangesEl = document.getElementById('merge-ranges');
              const mergeAll = mergeRangesEl ? mergeRangesEl.checked : false;
              
              if (mergeAll) {
                // Merge all ranges into one file
                const allPages = [];
                ranges.forEach(range => {
                  for (let i = range.from - 1; i <= range.to - 1; i++) {
                    if (i >= 0 && i < totalPages) {
                      allPages.push(i);
                    }
                  }
                });
                
                if (allPages.length > 0) {
                  splitTasks.push({
                    pages: allPages,
                    filename: `selected-ranges.pdf`
                  });
                }
              } else {
                // Create separate files for each range
                ranges.forEach((range, index) => {
                  const pages = [];
                  for (let i = range.from - 1; i <= range.to - 1; i++) {
                    if (i >= 0 && i < totalPages) {
                      pages.push(i);
                    }
                  }
                  
                  if (pages.length > 0) {
                    splitTasks.push({
                      pages: pages,
                      filename: `range-${range.from}-to-${range.to}.pdf`
                    });
                  }
                });
              }
            } else {
              // Fixed ranges
              const pagesPerFileEl = document.getElementById('pages-per-file');
              const pagesPerFile = pagesPerFileEl ? parseInt(pagesPerFileEl.value) || 1 : 1;
              for (let i = 0; i < totalPages; i += pagesPerFile) {
                const pages = Array.from(
                  {length: Math.min(pagesPerFile, totalPages - i)}, 
                  (_, j) => i + j
                );
                splitTasks.push({
                  pages: pages,
                  filename: `part-${Math.floor(i / pagesPerFile) + 1}.pdf`
                });
              }
            }
            break;
            
          case 'size':
            // Split by file size (simplified approach)
            const maxFileSizeEl = document.getElementById('max-file-size');
            const targetSizeMB = maxFileSizeEl ? parseInt(maxFileSizeEl.value) || 10 : 10;
            const fileInput = document.getElementById('split-file');
            const file = fileInput ? fileInput.files[0] : null;
            if (file) {
              const avgPageSize = file.size / totalPages;
              const pagesPerFile = Math.max(1, Math.floor((targetSizeMB * 1024 * 1024) / avgPageSize));
              
              for (let i = 0; i < totalPages; i += pagesPerFile) {
                const pages = Array.from(
                  {length: Math.min(pagesPerFile, totalPages - i)}, 
                  (_, j) => i + j
                );
                splitTasks.push({
                  pages: pages,
                  filename: `part-${Math.floor(i / pagesPerFile) + 1}.pdf`
                });
              }
            }
            break;
        }
        
        if (splitTasks.length === 0) {
          alert('‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏´‡∏ô‡πâ‡∏≤‡∏ó‡∏µ‡πà‡∏à‡∏∞‡πÅ‡∏¢‡∏Å ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤');
          if (progress) progress.classList.add('hidden');
          return;
        }
        
        processedFiles = [];
        
        for (let i = 0; i < splitTasks.length; i++) {
          const task = splitTasks[i];
          if (progressText) progressText.textContent = `‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÑ‡∏ü‡∏•‡πå ${i + 1} ‡∏à‡∏≤‡∏Å ${splitTasks.length}...`;
          if (progressBar) progressBar.style.width = `${((i + 1) / splitTasks.length) * 100}%`;
          
          if (typeof PDFLib !== 'undefined') {
            const newPdf = await PDFLib.PDFDocument.create();
            const pages = await newPdf.copyPages(pdfDocument, task.pages);
            pages.forEach(page => newPdf.addPage(page));
            
            const pdfBytes = await newPdf.save();
            const blob = new Blob([pdfBytes], { type: 'application/pdf' });
            
            processedFiles.push({
              blob: blob,
              filename: task.filename
            });
          }
          
          await new Promise(resolve => setTimeout(resolve, 100));
        }
        
        setTimeout(() => {
          if (progress) progress.classList.add('hidden');
          if (result) result.classList.remove('hidden');
          
          const resultText = document.getElementById('split-result-text');
          if (resultText) {
            resultText.textContent = `‡πÅ‡∏¢‡∏Å‡πÑ‡∏ü‡∏•‡πå‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢ ‡πÑ‡∏î‡πâ ${processedFiles.length} ‡πÑ‡∏ü‡∏•‡πå`;
          }
          
          const downloadLinks = document.getElementById('split-download-links');
          if (downloadLinks) {
            downloadLinks.innerHTML = '';
            
            processedFiles.forEach((file, index) => {
              const link = document.createElement('button');
              link.className = 'bg-red-600 text-white px-4 py-2 rounded-lg hover:bg-red-700 text-sm flex items-center justify-center gap-2';
              link.innerHTML = `<span>üì•</span><span class="truncate">${file.filename}</span>`;
              link.onclick = () => downloadSplitFile(index);
              downloadLinks.appendChild(link);
            });
            
            // Add download all button if multiple files
            if (processedFiles.length > 1) {
              const downloadAll = document.createElement('button');
              downloadAll.className = 'bg-green-600 text-white px-4 py-2 rounded-lg hover:bg-green-700 text-sm col-span-full';
              downloadAll.innerHTML = '<span class="mr-2">üì•</span>‡∏î‡∏≤‡∏ß‡∏ô‡πå‡πÇ‡∏´‡∏•‡∏î‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î';
              downloadAll.onclick = downloadAllSplitFiles;
              downloadLinks.appendChild(downloadAll);
            }
          }
          
        }, 500);
        
      } catch (error) {
        console.error('Error splitting PDF:', error);
        alert('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πÅ‡∏¢‡∏Å PDF: ' + error.message);
        if (progress) progress.classList.add('hidden');
      }
    }

    function getAllRanges() {
      const ranges = [];
      
      // Get Range 1
      const from1El = document.getElementById('range1-from');
      const to1El = document.getElementById('range1-to');
      if (from1El && to1El) {
        const from1 = parseInt(from1El.value);
        const to1 = parseInt(to1El.value);
        if (from1 && to1 && from1 <= to1) {
          ranges.push({ from: from1, to: to1 });
        }
      }
      
      // Get additional ranges
      for (let i = 2; i <= rangeCounter; i++) {
        const fromEl = document.getElementById(`range${i}-from`);
        const toEl = document.getElementById(`range${i}-to`);
        if (fromEl && toEl) {
          const from = parseInt(fromEl.value);
          const to = parseInt(toEl.value);
          if (from && to && from <= to) {
            ranges.push({ from: from, to: to });
          }
        }
      }
      
      return ranges;
    }

    function downloadSplitFile(index) {
      if (processedFiles[index]) {
        const file = processedFiles[index];
        const url = URL.createObjectURL(file.blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = file.filename;
        a.click();
        URL.revokeObjectURL(url);
      }
    }

    function downloadAllSplitFiles() {
      processedFiles.forEach((file, index) => {
        setTimeout(() => downloadSplitFile(index), index * 200);
      });
    }

    // PDF Thumbnail Generation
    async function generatePdfThumbnail(file) {
      try {
        if (typeof pdfjsLib === 'undefined') {
          console.error('PDF.js not loaded');
          return null;
        }
        
        const arrayBuffer = await file.arrayBuffer();
        const pdf = await pdfjsLib.getDocument({ data: arrayBuffer }).promise;
        const page = await pdf.getPage(1);
        
        const viewport = page.getViewport({ scale: 0.5 });
        const canvas = document.createElement('canvas');
        const context = canvas.getContext('2d');
        canvas.height = viewport.height;
        canvas.width = viewport.width;
        
        await page.render({
          canvasContext: context,
          viewport: viewport
        }).promise;
        
        return canvas.toDataURL();
      } catch (error) {
        console.error('Error generating thumbnail:', error);
        return null;
      }
    }

    // Merge PDF Functions
    function setupMergeListeners() {
      const fileInput = document.getElementById('merge-files');
      const dropZone = document.getElementById('merge-drop-zone');
      const mergeArea = document.getElementById('merge-area');

      if (fileInput) {
        fileInput.addEventListener('change', handleMergeFiles);
      }
      
      if (dropZone) {
        dropZone.addEventListener('dragover', handleDragOver);
        dropZone.addEventListener('dragleave', handleDragLeave);
        dropZone.addEventListener('drop', handleDrop);
      }

      // Merge area drag and drop
      if (mergeArea) {
        mergeArea.addEventListener('dragover', handleDragOver);
        mergeArea.addEventListener('dragleave', handleDragLeave);
        mergeArea.addEventListener('drop', handleDrop);
      }
    }

    function handleDragOver(e) {
      e.preventDefault();
      e.currentTarget.classList.add('dragover');
    }

    function handleDragLeave(e) {
      e.currentTarget.classList.remove('dragover');
    }

    function handleDrop(e) {
      e.preventDefault();
      e.currentTarget.classList.remove('dragover');
      
      const files = Array.from(e.dataTransfer.files).filter(f => f.type === 'application/pdf');
      if (files.length > 0) {
        addFilesToMerge(files);
      }
    }

    function handleMergeFiles(e) {
      const files = Array.from(e.target.files);
      addFilesToMerge(files);
    }

    async function addFilesToMerge(files) {
      for (const file of files) {
        const thumbnail = await generatePdfThumbnail(file);
        mergeFiles.push({
          file: file,
          id: Date.now() + Math.random(),
          thumbnail: thumbnail,
          name: file.name,
          size: file.size,
          lastModified: file.lastModified
        });
      }
      
      updateMergeUI();
    }

    async function updateMergeUI() {
      const emptyState = document.getElementById('empty-state');
      const pdfGrid = document.getElementById('pdf-grid');
      const mergeArea = document.getElementById('merge-area');
      const fileCount = document.getElementById('file-count');
      const orderControls = document.getElementById('order-controls');
      const mergeOptions = document.getElementById('merge-options');
      const mergeBtn = document.getElementById('merge-btn');
      const clearBtn = document.getElementById('clear-btn');

      if (mergeFiles.length === 0) {
        if (emptyState) emptyState.classList.remove('hidden');
        if (pdfGrid) pdfGrid.classList.add('hidden');
        if (orderControls) orderControls.classList.add('hidden');
        if (mergeOptions) mergeOptions.classList.add('hidden');
        if (clearBtn) clearBtn.style.display = 'none';
        if (mergeArea) mergeArea.classList.remove('has-files');
        if (mergeBtn) mergeBtn.disabled = true;
      } else {
        if (emptyState) emptyState.classList.add('hidden');
        if (pdfGrid) pdfGrid.classList.remove('hidden');
        if (orderControls) orderControls.classList.remove('hidden');
        if (mergeOptions) mergeOptions.classList.remove('hidden');
        if (clearBtn) clearBtn.style.display = 'block';
        if (mergeArea) mergeArea.classList.add('has-files');
        if (mergeBtn) mergeBtn.disabled = mergeFiles.length < 2;
      }

      if (fileCount) fileCount.textContent = mergeFiles.length;
      
      // Update PDF grid
      if (pdfGrid) {
        pdfGrid.innerHTML = '';
        mergeFiles.forEach((fileData, index) => {
          const card = createPdfCard(fileData, index);
          pdfGrid.appendChild(card);
        });
      }
    }

    function createPdfCard(fileData, index) {
      const card = document.createElement('div');
      card.className = 'pdf-card';
      card.draggable = true;
      card.dataset.index = index;
      
      card.innerHTML = `
        <div class="page-number">${index + 1}</div>
        <div class="remove-btn" onclick="removeFile(${index})">‚úï</div>
        <div class="pdf-thumbnail">
          ${fileData.thumbnail ? 
            `<img src="${fileData.thumbnail}" alt="PDF thumbnail" class="w-full h-full object-cover rounded-t-lg">` :
            `<div class="text-4xl text-gray-400">üìÑ</div>`
          }
        </div>
        <div class="p-4">
          <h4 class="font-medium text-gray-800 text-sm mb-1 truncate" title="${fileData.name}">
            ${fileData.name}
          </h4>
          <p class="text-xs text-gray-500">
            ${(fileData.size / 1024 / 1024).toFixed(2)} MB
          </p>
        </div>
      `;

      // Drag and drop events
      card.addEventListener('dragstart', handleDragStart);
      card.addEventListener('dragover', handleCardDragOver);
      card.addEventListener('dragenter', handleCardDragEnter);
      card.addEventListener('dragleave', handleCardDragLeave);
      card.addEventListener('drop', handleCardDrop);
      card.addEventListener('dragend', handleDragEnd);

      return card;
    }

    // Drag and Drop for reordering
    function handleDragStart(e) {
      draggedElement = e.currentTarget;
      e.currentTarget.classList.add('dragging');
      e.dataTransfer.effectAllowed = 'move';
      e.dataTransfer.setData('text/html', e.currentTarget.outerHTML);
    }

    function handleCardDragOver(e) {
      e.preventDefault();
      e.dataTransfer.dropEffect = 'move';
    }

    function handleCardDragEnter(e) {
      e.preventDefault();
      if (e.currentTarget !== draggedElement) {
        e.currentTarget.classList.add('drag-over');
      }
    }

    function handleCardDragLeave(e) {
      e.currentTarget.classList.remove('drag-over');
    }

    function handleCardDrop(e) {
      e.preventDefault();
      e.currentTarget.classList.remove('drag-over');
      
      if (e.currentTarget !== draggedElement) {
        const draggedIndex = parseInt(draggedElement.dataset.index);
        const targetIndex = parseInt(e.currentTarget.dataset.index);
        
        // Reorder files array
        const draggedFile = mergeFiles[draggedIndex];
        mergeFiles.splice(draggedIndex, 1);
        mergeFiles.splice(targetIndex, 0, draggedFile);
        
        updateMergeUI();
      }
    }

    function handleDragEnd(e) {
      e.currentTarget.classList.remove('dragging');
      document.querySelectorAll('.pdf-card').forEach(card => {
        card.classList.remove('drag-over');
      });
      draggedElement = null;
    }

    function removeFile(index) {
      mergeFiles.splice(index, 1);
      updateMergeUI();
    }

    function clearAllFiles() {
      mergeFiles = [];
      const mergeFilesInput = document.getElementById('merge-files');
      if (mergeFilesInput) mergeFilesInput.value = '';
      updateMergeUI();
    }

    function sortFiles(method) {
      switch(method) {
        case 'name':
          mergeFiles.sort((a, b) => a.name.localeCompare(b.name));
          break;
        case 'size':
          mergeFiles.sort((a, b) => a.size - b.size);
          break;
        case 'date':
          mergeFiles.sort((a, b) => a.lastModified - b.lastModified);
          break;
      }
      updateMergeUI();
    }

    function reverseOrder() {
      mergeFiles.reverse();
      updateMergeUI();
    }

    async function executeMerge() {
      if (mergeFiles.length < 2) {
        alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÑ‡∏ü‡∏•‡πå PDF ‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ô‡πâ‡∏≠‡∏¢ 2 ‡πÑ‡∏ü‡∏•‡πå');
        return;
      }

      const progress = document.getElementById('merge-progress');
      const progressBar = document.getElementById('merge-progress-bar');
      const progressText = document.getElementById('merge-progress-text');
      const result = document.getElementById('merge-result');
      
      try {
        if (progress) progress.classList.remove('hidden');
        if (result) result.classList.add('hidden');
        
        if (typeof PDFLib === 'undefined') {
          alert('PDF library not loaded');
          return;
        }
        
        const mergedPdf = await PDFLib.PDFDocument.create();
        
        for (let i = 0; i < mergeFiles.length; i++) {
          const fileData = mergeFiles[i];
          if (progressText) progressText.textContent = `‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏õ‡∏£‡∏∞‡∏°‡∏ß‡∏•‡∏ú‡∏• ${fileData.name}... ${Math.round((i / mergeFiles.length) * 100)}%`;
          if (progressBar) progressBar.style.width = `${(i / mergeFiles.length) * 90}%`;
          
          const arrayBuffer = await fileData.file.arrayBuffer();
          const pdf = await PDFLib.PDFDocument.load(arrayBuffer);
          const pages = await mergedPdf.copyPages(pdf, pdf.getPageIndices());
          
          pages.forEach(page => mergedPdf.addPage(page));
          await new Promise(resolve => setTimeout(resolve, 100));
        }
        
        if (progressText) progressText.textContent = '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÑ‡∏ü‡∏•‡πå‡πÉ‡∏´‡∏°‡πà...';
        if (progressBar) progressBar.style.width = '95%';
        
        const pdfBytes = await mergedPdf.save();
        mergedPdfBlob = new Blob([pdfBytes], { type: 'application/pdf' });
        
        if (progressBar) progressBar.style.width = '100%';
        if (progressText) progressText.textContent = '‡πÄ‡∏™‡∏£‡πá‡∏à‡∏™‡∏¥‡πâ‡∏ô!';
        
        setTimeout(() => {
          if (progress) progress.classList.add('hidden');
          if (result) result.classList.remove('hidden');
          
          const totalSize = mergeFiles.reduce((sum, fileData) => sum + fileData.size, 0);
          const mergeResultText = document.getElementById('merge-result-text');
          if (mergeResultText) {
            mergeResultText.textContent = 
              `‡∏£‡∏ß‡∏° ${mergeFiles.length} ‡πÑ‡∏ü‡∏•‡πå‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢ ‡∏Ç‡∏ô‡∏≤‡∏î‡πÑ‡∏ü‡∏•‡πå: ${(mergedPdfBlob.size / 1024 / 1024).toFixed(2)} MB (‡πÄ‡∏î‡∏¥‡∏°: ${(totalSize / 1024 / 1024).toFixed(2)} MB)`;
          }
        }, 1000);
        
      } catch (error) {
        console.error('Error merging PDFs:', error);
        alert('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏£‡∏ß‡∏° PDF: ' + error.message);
        if (progress) progress.classList.add('hidden');
      }
    }

    function downloadMergedFile() {
      if (mergedPdfBlob) {
        const url = URL.createObjectURL(mergedPdfBlob);
        const a = document.createElement('a');
        a.href = url;
        a.download = `merged-pdf-${new Date().toISOString().split('T')[0]}.pdf`;
        a.click();
        URL.revokeObjectURL(url);
      }
    }

    // Compress PDF Functions
    function setupCompressListeners() {
      const fileInput = document.getElementById('compress-file');
      const dropZone = document.getElementById('compress-drop-zone');
      
      if (fileInput) {
        fileInput.addEventListener('change', handleCompressFile);
      }
      
      if (dropZone) {
        dropZone.addEventListener('dragover', (e) => {
          e.preventDefault();
          dropZone.classList.add('dragover');
        });
        
        dropZone.addEventListener('dragleave', () => {
          dropZone.classList.remove('dragover');
        });
        
        dropZone.addEventListener('drop', (e) => {
          e.preventDefault();
          dropZone.classList.remove('dragover');
          const files = Array.from(e.dataTransfer.files).filter(f => f.type === 'application/pdf');
          if (files.length === 1 && fileInput) {
            const dt = new DataTransfer();
            files.forEach(file => dt.items.add(file));
            fileInput.files = dt.files;
            handleCompressFile({ target: fileInput });
          }
        });
      }
    }

    async function handleCompressFile(e) {
      const file = e.target.files[0];
      const fileInfo = document.getElementById('compress-file-info');
      const options = document.getElementById('compress-options');
      const compressBtn = document.getElementById('compress-btn');
      
      if (file) {
        const sizeMB = (file.size / 1024 / 1024).toFixed(2);
        const compressOriginalSize = document.getElementById('compress-original-size');
        if (compressOriginalSize) {
          compressOriginalSize.innerHTML = `
            <div class="grid grid-cols-2 gap-4">
              <div>‡∏ä‡∏∑‡πà‡∏≠‡πÑ‡∏ü‡∏•‡πå: <strong>${file.name}</strong></div>
              <div>‡∏Ç‡∏ô‡∏≤‡∏î‡πÑ‡∏ü‡∏•‡πå: <strong>${sizeMB} MB</strong></div>
            </div>
          `;
        }
        
        if (fileInfo) fileInfo.classList.remove('hidden');
        if (options) options.classList.remove('hidden');
        if (compressBtn) compressBtn.disabled = false;
      } else {
        if (fileInfo) fileInfo.classList.add('hidden');
        if (options) options.classList.add('hidden');
        if (compressBtn) compressBtn.disabled = true;
      }
    }

    function selectCompressionLevel(level) {
      document.querySelectorAll('[onclick^="selectCompressionLevel"]').forEach(div => {
        div.className = div.className.replace('border-green-500 bg-green-50', 'border-gray-200');
      });
      
      if (event && event.currentTarget) {
        event.currentTarget.className = event.currentTarget.className.replace('border-gray-200', 'border-green-500 bg-green-50');
      }
      
      const levelCheckbox = document.getElementById(`compression-${level}`);
      if (levelCheckbox) levelCheckbox.checked = true;
    }

    async function executeCompress() {
      const fileInput = document.getElementById('compress-file');
      const file = fileInput ? fileInput.files[0] : null;
      const levelEl = document.querySelector('input[name="compression-level"]:checked');
      const level = levelEl ? levelEl.value : 'medium';
      const progress = document.getElementById('compress-progress');
      const progressBar = document.getElementById('compress-progress-bar');
      const progressText = document.getElementById('compress-progress-text');
      const result = document.getElementById('compress-result');
      
      if (!file) {
        alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÑ‡∏ü‡∏•‡πå PDF');
        return;
      }
      
      try {
        if (progress) progress.classList.remove('hidden');
        if (result) result.classList.add('hidden');
        
        if (progressText) progressText.textContent = '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡πÑ‡∏ü‡∏•‡πå...';
        if (progressBar) progressBar.style.width = '20%';
        
        if (typeof PDFLib === 'undefined') {
          alert('PDF library not loaded');
          return;
        }
        
        const arrayBuffer = await file.arrayBuffer();
        const pdf = await PDFLib.PDFDocument.load(arrayBuffer);
        
        if (progressText) progressText.textContent = '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ö‡∏µ‡∏ö‡∏≠‡∏±‡∏î‡πÑ‡∏ü‡∏•‡πå...';
        if (progressBar) progressBar.style.width = '60%';
        
        // Compression settings based on level
        let compressionOptions = {
          useObjectStreams: true,
          addDefaultPage: false
        };
        
        switch(level) {
          case 'low':
            compressionOptions.objectsPerTick = 20;
            break;
          case 'medium':
            compressionOptions.objectsPerTick = 50;
            break;
          case 'high':
            compressionOptions.objectsPerTick = 100;
            break;
        }
        
        if (progressText) progressText.textContent = '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÑ‡∏ü‡∏•‡πå‡πÉ‡∏´‡∏°‡πà...';
        if (progressBar) progressBar.style.width = '90%';
        
        const pdfBytes = await pdf.save(compressionOptions);
        compressedPdfBlob = new Blob([pdfBytes], { type: 'application/pdf' });
        
        if (progressBar) progressBar.style.width = '100%';
        if (progressText) progressText.textContent = '‡πÄ‡∏™‡∏£‡πá‡∏à‡∏™‡∏¥‡πâ‡∏ô!';
        
        const originalSize = file.size;
        const compressedSize = compressedPdfBlob.size;
        const compressionRatio = ((originalSize - compressedSize) / originalSize * 100);
        
        setTimeout(() => {
          if (progress) progress.classList.add('hidden');
          if (result) result.classList.remove('hidden');
          
          const compressStats = document.getElementById('compress-stats');
          if (compressStats) {
            compressStats.innerHTML = `
              <div class="grid grid-cols-1 md:grid-cols-3 gap-4 text-center">
                <div>
                  <div class="text-lg font-semibold">${(originalSize / 1024 / 1024).toFixed(2)} MB</div>
                  <div class="text-sm">‡∏Ç‡∏ô‡∏≤‡∏î‡πÄ‡∏î‡∏¥‡∏°</div>
                </div>
                <div>
                  <div class="text-lg font-semibold">${(compressedSize / 1024 / 1024).toFixed(2)} MB</div>
                  <div class="text-sm">‡∏Ç‡∏ô‡∏≤‡∏î‡πÉ‡∏´‡∏°‡πà</div>
                </div>
                <div>
                  <div class="text-lg font-semibold text-green-600">${compressionRatio > 0 ? compressionRatio.toFixed(1) : 0}%</div>
                  <div class="text-sm">‡∏•‡∏î‡∏•‡∏á</div>
                </div>
              </div>
            `;
          }
        }, 500);
        
      } catch (error) {
        console.error('Error compressing PDF:', error);
        alert('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏ö‡∏µ‡∏ö‡∏≠‡∏±‡∏î PDF: ' + error.message);
        if (progress) progress.classList.add('hidden');
      }
    }

    function downloadCompressedFile() {
      if (compressedPdfBlob) {
        const url = URL.createObjectURL(compressedPdfBlob);
        const a = document.createElement('a');
        a.href = url;
        a.download = `compressed-${new Date().toISOString().split('T')[0]}.pdf`;
        a.click();
        URL.revokeObjectURL(url);
      }
    }

    // Initialize when DOM is loaded
    document.addEventListener('DOMContentLoaded', () => {
      console.log('üöÄ Initializing PDF Tools...');
      
      // Setup event listeners
      setupMergeListeners();
      setupSplitListeners();
      setupCompressListeners();
      
      // Handle browser back/forward
      window.addEventListener('popstate', (e) => {
        const hash = window.location.hash;
        if (hash === '#pdftools' || hash === '') {
          showGrid();
        } else if (hash.startsWith('#pdftools-')) {
          const tool = hash.replace('#pdftools-', '');
          openTool(tool);
        }
      });
      
      // Initialize based on current hash
      const hash = window.location.hash;
      if (hash.startsWith('#pdftools-')) {
        const tool = hash.replace('#pdftools-', '');
        openTool(tool);
      }
      
      console.log('‚úÖ Advanced PDF Tools initialized successfully');
    });

    // Make functions globally available for onclick handlers
    window.goBack = goBack;
    window.showGrid = showGrid;
    window.openTool = openTool;
    window.setEditTool = setEditTool;
    window.openEditPdf = openEditPdf;
    window.prevEditPage = prevEditPage;
    window.nextEditPage = nextEditPage;
    window.editZoom = editZoom;
    window.editUndo = editUndo;
    window.editRedo = editRedo;
    window.saveEditedPdf = saveEditedPdf;
    window.deleteActiveEditObject = deleteActiveEditObject;
    window.switchSplitTab = switchSplitTab;
    window.selectRangeMode = selectRangeMode;
    window.addRange = addRange;
    window.removeRange = removeRange;
    window.executeSplit = executeSplit;
    window.downloadSplitFile = downloadSplitFile;
    window.downloadAllSplitFiles = downloadAllSplitFiles;
    window.togglePageSelection = togglePageSelection;
    window.selectAllPages = selectAllPages;
    window.deselectAllPages = deselectAllPages;
    window.sortFiles = sortFiles;
    window.reverseOrder = reverseOrder;
    window.clearAllFiles = clearAllFiles;
    window.executeMerge = executeMerge;
    window.downloadMergedFile = downloadMergedFile;
    window.removeFile = removeFile;
    window.selectCompressionLevel = selectCompressionLevel;
    window.executeCompress = executeCompress;
    window.downloadCompressedFile = downloadCompressedFile;
  </script>
</body>
</html>
